{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/components/ImageEditor.tsx"],"sourcesContent":["// components/ImageEditor.tsx\r\n// Version: 2.2.0 - 2025-11-05 - HIGH-RES PNG FOR LASER ENGRAVING\r\n// ‚úÖ Fixed: Changed to PNG format for transparency support\r\n// ‚úÖ Fixed: Increased resolution to 2400px for laser engraving quality\r\n// ‚úÖ Fixed: Increased file size limit to 2MB for high-res images\r\n// ‚úÖ Fixed: Increased quality to 0.95 for best engraving results\r\n// - Kept: Disabled image movement during save/processing\r\n// - Kept: Converts uploaded images to black & white (grayscale) on save\r\n'use client'\r\n\r\nimport React, { useState, useRef, useEffect } from 'react'\r\nimport { ZoomIn, ZoomOut, RotateCcw, X } from 'lucide-react'\r\nimport imageCompression from 'browser-image-compression'\r\n\r\n// TypeScript interfaces\r\ninterface ImageEditorProps {\r\n  show: boolean\r\n  onHide: () => void\r\n  uploadedImage: string | null\r\n  maskImage: string | null\r\n  onSave: (compressedImage: string) => void\r\n}\r\n\r\ninterface Position {\r\n  x: number\r\n  y: number\r\n}\r\n\r\ninterface MaskDimensions {\r\n  width: number\r\n  height: number\r\n}\r\n\r\nconst ImageEditor: React.FC<ImageEditorProps> = ({ \r\n  show, \r\n  onHide, \r\n  uploadedImage, \r\n  maskImage, \r\n  onSave \r\n}) => {\r\n  // State management\r\n  const [position, setPosition] = useState<Position>({ x: 0, y: 0 })\r\n  const [scale, setScale] = useState<number>(1)\r\n  const [isDragging, setIsDragging] = useState<boolean>(false)\r\n  const [dragStart, setDragStart] = useState<Position>({ x: 0, y: 0 })\r\n  const [isProcessing, setIsProcessing] = useState<boolean>(false)\r\n  const [maskDimensions, setMaskDimensions] = useState<MaskDimensions>({ width: 0, height: 0 })\r\n  const [isImageCentered, setIsImageCentered] = useState<boolean>(false)\r\n  \r\n  // Refs\r\n  const containerRef = useRef<HTMLDivElement>(null)\r\n  const imageRef = useRef<HTMLImageElement>(null)\r\n  const maskRef = useRef<HTMLImageElement>(null)\r\n  const canvasRef = useRef<HTMLCanvasElement>(null)\r\n\r\n  // Environment check\r\n  const isDev = process.env.NEXT_PUBLIC_ENV_MODE === 'development'\r\n  const isTest = process.env.NEXT_PUBLIC_ENV_MODE === 'testing'\r\n  const isProd = process.env.NEXT_PUBLIC_ENV_MODE === 'production'\r\n\r\n  // Compression settings based on environment\r\n  // PNG for transparency support, higher resolution for laser engraving\r\n  const compressionSettings = {\r\n    maxSizeMB: 2, // Allow larger files for high-res PNG\r\n    maxWidthOrHeight: 2400, // Higher resolution for engraving\r\n    useWebWorker: true,\r\n    fileType: 'image/png' as const, // PNG for transparency\r\n    initialQuality: 0.95 // High quality for engraving\r\n  }\r\n\r\n  // Log only in dev/test\r\n  const log = (...args: any[]) => {\r\n    if (isDev || isTest) {\r\n      console.log('[IMAGE_EDITOR]', ...args)\r\n    }\r\n  }\r\n\r\n  const logError = (...args: any[]) => {\r\n    if (isDev || isTest) {\r\n      console.error('[IMAGE_EDITOR ERROR]', ...args)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Center the uploaded image within the mask\r\n   * Called after both images are loaded\r\n   */\r\n  const centerImage = () => {\r\n    if (!imageRef.current || !containerRef.current || isImageCentered) return\r\n    \r\n    const imgRect = imageRef.current.getBoundingClientRect()\r\n    const containerRect = containerRef.current.getBoundingClientRect()\r\n    \r\n    // Calculate center position\r\n    const centerX = (containerRect.width - imgRect.width) / 2\r\n    const centerY = (containerRect.height - imgRect.height) / 2\r\n    \r\n    setPosition({ x: centerX, y: centerY })\r\n    setIsImageCentered(true)\r\n    \r\n    log('Image centered at:', { x: centerX, y: centerY })\r\n  }\r\n\r\n  /**\r\n   * Convert image to grayscale (black & white)\r\n   */\r\n  const convertToGrayscale = (ctx: CanvasRenderingContext2D, canvas: HTMLCanvasElement) => {\r\n    log('Converting to grayscale...')\r\n    \r\n    // Get image data\r\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\r\n    const data = imageData.data\r\n    \r\n    // Convert each pixel to grayscale\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      // Get RGB values\r\n      const r = data[i]\r\n      const g = data[i + 1]\r\n      const b = data[i + 2]\r\n      \r\n      // Calculate grayscale using luminosity method (more accurate)\r\n      // Formula: 0.299*R + 0.587*G + 0.114*B\r\n      const gray = Math.round(0.299 * r + 0.587 * g + 0.114 * b)\r\n      \r\n      // Set RGB to same gray value\r\n      data[i] = gray      // Red\r\n      data[i + 1] = gray  // Green\r\n      data[i + 2] = gray  // Blue\r\n      // Alpha (data[i + 3]) stays the same\r\n    }\r\n    \r\n    // Put grayscale data back\r\n    ctx.putImageData(imageData, 0, 0)\r\n    \r\n    log('Grayscale conversion complete')\r\n  }\r\n\r\n  /**\r\n   * Compress image to reduce file size\r\n   */\r\n  const compressImage = async (dataUrl: string): Promise<string> => {\r\n    try {\r\n      // Convert data URL to blob\r\n      const base64Data = dataUrl.split(',')[1]\r\n      const mimeType = dataUrl.split(',')[0].split(':')[1].split(';')[0]\r\n      const byteCharacters = atob(base64Data)\r\n      const byteNumbers = new Array(byteCharacters.length)\r\n      \r\n      for (let i = 0; i < byteCharacters.length; i++) {\r\n        byteNumbers[i] = byteCharacters.charCodeAt(i)\r\n      }\r\n      \r\n      const byteArray = new Uint8Array(byteNumbers)\r\n      const blob = new Blob([byteArray], { type: mimeType })\r\n      \r\n      log(`Original size: ${(blob.size / 1024 / 1024).toFixed(2)}MB`)\r\n      \r\n      // Compress the blob\r\n      const compressedFile = await imageCompression(blob, compressionSettings)\r\n      \r\n      log(`Compressed size: ${(compressedFile.size / 1024 / 1024).toFixed(2)}MB`)\r\n      \r\n      // Convert back to data URL\r\n      return new Promise((resolve) => {\r\n        const reader = new FileReader()\r\n        reader.onloadend = () => resolve(reader.result as string)\r\n        reader.readAsDataURL(compressedFile)\r\n      })\r\n      \r\n    } catch (error) {\r\n      logError('Compression failed:', error)\r\n      return dataUrl // Return original if compression fails\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up mask dimensions and aspect ratio\r\n   */\r\n  useEffect(() => {\r\n    if (!show || !maskImage || !containerRef.current) return\r\n    \r\n    log('Setting up mask...')\r\n    \r\n    const img = new Image()\r\n    img.onload = () => {\r\n      if (!containerRef.current) {\r\n        logError('Container ref lost during image load')\r\n        return\r\n      }\r\n      \r\n      const aspectRatio = img.naturalWidth / img.naturalHeight\r\n      log('Aspect ratio:', aspectRatio)\r\n      \r\n      containerRef.current.style.aspectRatio = `${aspectRatio}`\r\n      \r\n      setMaskDimensions({\r\n        width: img.naturalWidth,\r\n        height: img.naturalHeight\r\n      })\r\n    }\r\n    img.src = maskImage\r\n  }, [show, maskImage])\r\n\r\n  /**\r\n   * Center image when modal opens or image changes\r\n   */\r\n  useEffect(() => {\r\n    if (show && uploadedImage) {\r\n      // Reset centering flag when new image or modal opens\r\n      setIsImageCentered(false)\r\n      // Small delay to ensure images are rendered\r\n      setTimeout(() => {\r\n        centerImage()\r\n      }, 100)\r\n    }\r\n  }, [show, uploadedImage])\r\n\r\n  /**\r\n   * Handle zoom with optional cursor position\r\n   * FIX: Disabled during processing\r\n   */\r\n  const handleZoom = (newScale: number, cursorX: number | null = null, cursorY: number | null = null) => {\r\n    // FIX: Don't allow zoom during processing\r\n    if (isProcessing) return\r\n    \r\n    const minScale = 0.1\r\n    const maxScale = 5\r\n    newScale = Math.max(minScale, Math.min(maxScale, newScale))\r\n\r\n    if (cursorX !== null && cursorY !== null) {\r\n      // Cursor-based zoom (mousewheel)\r\n      const factor = newScale / scale\r\n      const newX = position.x - cursorX * (factor - 1)\r\n      const newY = position.y - cursorY * (factor - 1)\r\n      setPosition({ x: newX, y: newY })\r\n    } else {\r\n      // Center-based zoom (buttons)\r\n      if (!imageRef.current) return\r\n      const rect = imageRef.current.getBoundingClientRect()\r\n      const centerX = rect.width / 2\r\n      const centerY = rect.height / 2\r\n      const factor = newScale / scale\r\n      const newX = position.x - centerX * (factor - 1)\r\n      const newY = position.y - centerY * (factor - 1)\r\n      setPosition({ x: newX, y: newY })\r\n    }\r\n\r\n    setScale(newScale)\r\n  }\r\n\r\n  /**\r\n   * Handle mouse wheel zoom\r\n   * FIX: Disabled during processing\r\n   */\r\n  const handleWheel = (e: WheelEvent) => {\r\n    // FIX: Don't allow zoom during processing\r\n    if (isProcessing) return\r\n    \r\n    if (e.cancelable) e.preventDefault()\r\n\r\n    if (!imageRef.current || !containerRef.current) return\r\n\r\n    const rect = imageRef.current.getBoundingClientRect()\r\n    const cursorX = e.clientX - rect.left\r\n    const cursorY = e.clientY - rect.top\r\n\r\n    const scaleFactor = 0.025\r\n    const newScale = scale + Math.sign(-e.deltaY) * scaleFactor\r\n\r\n    handleZoom(newScale, cursorX, cursorY)\r\n  }\r\n\r\n  /**\r\n   * Handle mouse down - start dragging\r\n   * FIX: Disabled during processing\r\n   */\r\n  const handleMouseDown = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    // FIX: Don't allow dragging during processing\r\n    if (isProcessing) return\r\n    \r\n    e.preventDefault()\r\n    setIsDragging(true)\r\n    setDragStart({\r\n      x: e.clientX - position.x,\r\n      y: e.clientY - position.y,\r\n    })\r\n\r\n    if (containerRef.current) {\r\n      containerRef.current.style.cursor = 'grabbing'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle mouse up - stop dragging\r\n   */\r\n  const handleMouseUp = () => {\r\n    setIsDragging(false)\r\n\r\n    if (containerRef.current) {\r\n      containerRef.current.style.cursor = isProcessing ? 'not-allowed' : 'grab'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle mouse move - drag image\r\n   * FIX: Disabled during processing\r\n   */\r\n  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {\r\n    // FIX: Don't allow dragging during processing\r\n    if (!isDragging || isProcessing) return\r\n    \r\n    const newX = e.clientX - dragStart.x\r\n    const newY = e.clientY - dragStart.y\r\n    \r\n    setPosition({ x: newX, y: newY })\r\n  }\r\n\r\n  /**\r\n   * Reset position and scale - returns to centered position\r\n   */\r\n  const handleReset = () => {\r\n    // Don't allow reset during processing\r\n    if (isProcessing) return\r\n    \r\n    setScale(1)\r\n    setIsImageCentered(false)\r\n    // Re-center after reset\r\n    setTimeout(() => {\r\n      centerImage()\r\n    }, 50)\r\n    log('Reset position and scale')\r\n  }\r\n  \r\n  /**\r\n   * Save the masked image\r\n   * FIX: Converts to grayscale (black & white) before saving\r\n   */\r\n  const handleSave = async () => {\r\n    if (!uploadedImage || !maskImage || !imageRef.current || !maskRef.current) {\r\n      logError('Missing required elements for saving')\r\n      return\r\n    }\r\n\r\n    setIsProcessing(true)\r\n    \r\n    // FIX: Update cursor to indicate processing\r\n    if (containerRef.current) {\r\n      containerRef.current.style.cursor = 'not-allowed'\r\n    }\r\n    \r\n    log('Starting save process...')\r\n\r\n    try {\r\n      const canvas = canvasRef.current\r\n      if (!canvas) throw new Error('Canvas not found')\r\n      \r\n      const ctx = canvas.getContext('2d', { willReadFrequently: true })\r\n      if (!ctx) throw new Error('Canvas context not found')\r\n\r\n      // Load images\r\n      const [uploadedImg, maskImg] = await Promise.all([\r\n        new Promise<HTMLImageElement>((resolve, reject) => {\r\n          const img = new Image()\r\n          img.onload = () => resolve(img)\r\n          img.onerror = reject\r\n          img.src = uploadedImage\r\n        }),\r\n        new Promise<HTMLImageElement>((resolve, reject) => {\r\n          const img = new Image()\r\n          img.onload = () => resolve(img)\r\n          img.onerror = reject\r\n          img.src = maskImage\r\n        })\r\n      ])\r\n\r\n      // Get rendered dimensions\r\n      const maskRect = maskRef.current.getBoundingClientRect()\r\n\r\n      // Set canvas to mask's natural dimensions\r\n      canvas.width = maskImg.naturalWidth\r\n      canvas.height = maskImg.naturalHeight\r\n\r\n      // Clear canvas\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n      // Calculate scaling factors\r\n      const scaleFactorX = maskImg.naturalWidth / maskRect.width\r\n      const scaleFactorY = maskImg.naturalHeight / maskRect.height\r\n\r\n      // Calculate scaled dimensions\r\n      const scaledWidth = imageRef.current.width * scale * scaleFactorX\r\n      const scaledHeight = imageRef.current.height * scale * scaleFactorY\r\n\r\n      // Calculate position\r\n      const canvasX = position.x * scaleFactorX\r\n      const canvasY = position.y * scaleFactorY\r\n\r\n      // Save context state\r\n      ctx.save()\r\n\r\n      // Create clipping mask\r\n      ctx.beginPath()\r\n      ctx.rect(0, 0, maskImg.naturalWidth, maskImg.naturalHeight)\r\n      ctx.clip()\r\n\r\n      // Draw uploaded image\r\n      ctx.drawImage(\r\n        uploadedImg,\r\n        canvasX, canvasY,\r\n        scaledWidth, scaledHeight\r\n      )\r\n\r\n      // Restore context (remove clipping)\r\n      ctx.restore()\r\n\r\n      // FIX: Convert to grayscale BEFORE adding the mask\r\n      convertToGrayscale(ctx, canvas)\r\n\r\n      // Draw mask on top (after grayscale conversion)\r\n      ctx.drawImage(maskImg, 0, 0)\r\n\r\n      // Convert to data URL\r\n      const dataUrl = canvas.toDataURL('image/png', 1.0)\r\n\r\n      if (dataUrl === 'data:,') {\r\n        throw new Error('Generated data URL is invalid')\r\n      }\r\n\r\n      // Compress final image\r\n      log('Compressing final image...')\r\n      const compressedDataUrl = await compressImage(dataUrl)\r\n\r\n      log('Save complete!')\r\n      onSave(compressedDataUrl)\r\n      onHide()\r\n\r\n    } catch (error) {\r\n      logError('Error saving image:', error)\r\n    } finally {\r\n      setIsProcessing(false)\r\n      \r\n      // Reset cursor\r\n      if (containerRef.current) {\r\n        containerRef.current.style.cursor = 'grab'\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set up wheel event listener\r\n   */\r\n  useEffect(() => {\r\n    const container = containerRef.current\r\n    if (!container) return\r\n\r\n    container.addEventListener(\"wheel\", handleWheel, { passive: false })\r\n    return () => container.removeEventListener(\"wheel\", handleWheel)\r\n  }, [scale, position, isProcessing]) // FIX: Added isProcessing dependency\r\n\r\n  // Handle ESC key to close modal\r\n  useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && show && !isProcessing) {\r\n        onHide()\r\n      }\r\n    }\r\n    \r\n    if (show) {\r\n      document.addEventListener('keydown', handleEscape)\r\n      return () => document.removeEventListener('keydown', handleEscape)\r\n    }\r\n  }, [show, isProcessing, onHide])\r\n\r\n  // FIX: Update cursor when processing state changes\r\n  useEffect(() => {\r\n    if (containerRef.current) {\r\n      containerRef.current.style.cursor = isProcessing ? 'not-allowed' : 'grab'\r\n    }\r\n  }, [isProcessing])\r\n\r\n  // Don't render if not showing\r\n  if (!show) return null\r\n\r\n  return (\r\n    <>\r\n      {/* Modal Backdrop */}\r\n      <div \r\n        className=\"fixed inset-0 bg-black/70 z-[1040] transition-opacity\"\r\n        onClick={!isProcessing ? onHide : undefined}\r\n      />\r\n\r\n      {/* Modal Dialog */}\r\n      <div className=\"fixed inset-0 z-[1050] flex items-center justify-center p-4 overflow-y-auto\">\r\n        <div \r\n          className=\"image-editor-modal relative w-full max-w-[90vw] mx-auto my-8\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Modal Content - uses your custom .image-editor-modal CSS */}\r\n          <div className=\"bg-[var(--surface-900)] rounded-lg shadow-xl w-fit mx-auto max-w-[90vw]\">\r\n            {/* Modal Header */}\r\n            <div className=\"flex items-center justify-between border-b border-[var(--surface-700)] px-6 py-4\">\r\n              <h3 className=\"text-[var(--surface-50)] text-xl font-medium\">\r\n                Edit Image\r\n              </h3>\r\n              <button\r\n                onClick={onHide}\r\n                disabled={isProcessing}\r\n                className=\"text-gray-400 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                <X size={24} />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Modal Body */}\r\n            <div className=\"p-6\">\r\n              <div \r\n                ref={containerRef}\r\n                className={`editor-workspace ${isProcessing ? 'pointer-events-none opacity-75' : ''}`}\r\n                onMouseDown={handleMouseDown}\r\n                onMouseMove={handleMouseMove}\r\n                onMouseUp={handleMouseUp}\r\n                onMouseLeave={handleMouseUp}\r\n              >\r\n                {/* Zoom Controls - uses your custom .editor-zoom-controls CSS */}\r\n                <div className=\"editor-zoom-controls\">\r\n                  <button \r\n                    onClick={() => handleZoom(scale * 1.1)}\r\n                    title=\"Zoom In\"\r\n                    disabled={isProcessing}\r\n                    className=\"w-10 h-10 flex items-center justify-center bg-[var(--surface-700)] border border-[var(--surface-600)] text-[var(--surface-50)] rounded hover:bg-[var(--surface-600)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <ZoomIn size={18} />\r\n                  </button>\r\n                  \r\n                  <div className=\"zoom-value text-center text-[var(--surface-200)] text-sm py-1\">\r\n                    {Math.round(scale * 100)}%\r\n                  </div>\r\n                  \r\n                  <button \r\n                    onClick={() => handleZoom(scale * 0.9)}\r\n                    title=\"Zoom Out\"\r\n                    disabled={isProcessing}\r\n                    className=\"w-10 h-10 flex items-center justify-center bg-[var(--surface-700)] border border-[var(--surface-600)] text-[var(--surface-50)] rounded hover:bg-[var(--surface-600)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  >\r\n                    <ZoomOut size={18} />\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Uploaded Image */}\r\n                <img\r\n                  ref={imageRef}\r\n                  src={uploadedImage || ''}\r\n                  alt=\"Upload\"\r\n                  className=\"uploaded-image\"\r\n                  onLoad={centerImage}\r\n                  style={{\r\n                    transform: `translate(${position.x}px, ${position.y}px) scale(${scale})`,\r\n                    transformOrigin: '0 0',\r\n                    pointerEvents: isProcessing ? 'none' : 'auto'\r\n                  }}\r\n                />\r\n\r\n                {/* Mask Image */} \r\n                {maskImage && (\r\n                  <img\r\n                    ref={maskRef}\r\n                    src={maskImage}\r\n                    alt=\"Mask\"\r\n                    className=\"mask-image\"\r\n                    onLoad={() => log('Mask loaded')}\r\n                    onError={(e) => logError('Mask failed:', e)}\r\n                  />\r\n                )}\r\n                \r\n                {/* Processing Overlay */}\r\n                {isProcessing && (\r\n                  <div className=\"absolute inset-0 bg-black/70 flex items-center justify-center z-20 rounded-lg\">\r\n                    <div className=\"text-center text-white\">\r\n                      <div \r\n                        className=\"inline-block w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin mb-2\"\r\n                        role=\"status\"\r\n                      >\r\n                        <span className=\"sr-only\">Processing...</span>\r\n                      </div>\r\n                      <div className=\"font-semibold\">Converting to Black & White...</div>\r\n                      <div className=\"text-sm text-gray-300 mt-1\">Compressing and saving...</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                \r\n                {/* Hidden canvas for rendering */}\r\n                <canvas\r\n                  ref={canvasRef}\r\n                  style={{ display: 'none' }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Modal Footer */}\r\n            <div className=\"modal-footer border-t border-[var(--surface-700)] px-6 py-4 flex justify-between gap-4\">\r\n              {/* Left side - Utility actions */}\r\n              <div className=\"modal-footer-group flex gap-3\">\r\n                <button \r\n                  className=\"btn-reset flex items-center gap-2 text-[var(--surface-400)] hover:text-[var(--surface-200)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  onClick={handleReset}\r\n                  title=\"Reset Image Position\"\r\n                  disabled={isProcessing}\r\n                >\r\n                  <RotateCcw size={18} />\r\n                  <span>Reset</span>\r\n                </button>\r\n              </div>\r\n\r\n              {/* Right side - Primary actions */}\r\n              <div className=\"modal-footer-group flex gap-3\">\r\n                <button \r\n                  className=\"btn btn-secondary px-6 py-2 rounded-lg disabled:cursor-not-allowed\"\r\n                  onClick={onHide}\r\n                  disabled={isProcessing}\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button \r\n                  className=\"btn btn-primary px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                  onClick={handleSave}\r\n                  disabled={isProcessing}\r\n                >\r\n                  {isProcessing ? (\r\n                    <span className=\"flex items-center gap-2\">\r\n                      <span \r\n                        className=\"cursor-pointer inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"\r\n                        role=\"status\" \r\n                        aria-hidden=\"true\"\r\n                      />\r\n                      Processing...\r\n                    </span>\r\n                  ) : (\r\n                    'Save Changes'\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default ImageEditor"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 787, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/utils/logger.ts"],"sourcesContent":["// utils/logger.ts\r\n// Version: 1.3.0 | Date: 2025-11-05\r\n// ‚úÖ Fixed: Added missing warn() method\r\n// Environment-aware logging utility\r\n\r\nconst ENV_MODE = process.env.NEXT_PUBLIC_ENV_MODE || 'development'\r\nconst IS_DEV = ENV_MODE === 'development'\r\nconst IS_TEST = ENV_MODE === 'testing'\r\nconst IS_PROD = ENV_MODE === 'production'\r\n\r\n// Only log in dev and testing modes\r\nconst shouldLog = IS_DEV || IS_TEST\r\n\r\nexport const logger = {\r\n  // API calls\r\n  api: (endpoint: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üåê API Call: ${endpoint}`, data)\r\n  },\r\n\r\n  // Success messages\r\n  success: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚úÖ ${message}`, data)\r\n  },\r\n\r\n  // Warning messages\r\n  warn: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.warn(`‚ö†Ô∏è ${message}`, data)\r\n  },\r\n\r\n  // Error tracking\r\n  error: (message: string, error?: any) => {\r\n    if (!shouldLog) return\r\n    console.error(`‚ùå ${message}`, error)\r\n  },\r\n\r\n  // Image loading\r\n  image: (status: 'loading' | 'loaded' | 'error', path: string) => {\r\n    if (!shouldLog) return\r\n    const icon = status === 'loaded' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥'\r\n    console.log(`${icon} Image ${status}: ${path}`)\r\n  },\r\n\r\n  // Order processing\r\n  order: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üì¶ Order ${step}:`, data)\r\n  },\r\n\r\n  // Product data\r\n  product: (action: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üî∑ Product ${action}:`, data)\r\n  },\r\n\r\n  // Payment processing\r\n  payment: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üí≥ Payment ${step}:`, data)\r\n  },\r\n\r\n  // General info\r\n  info: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚ÑπÔ∏è ${message}`, data)\r\n  }\r\n}\r\n\r\nexport const isDevelopment = IS_DEV\r\nexport const isTesting = IS_TEST\r\nexport const isProduction = IS_PROD"],"names":[],"mappings":"AAAA,kBAAkB;AAClB,oCAAoC;AACpC,uCAAuC;AACvC,oCAAoC;;;;;;;AAEnB;AAAjB,MAAM,WAAW,mDAAoC;AACrD,MAAM,SAAS,aAAa;AAC5B,MAAM,UAAU,aAAa;AAC7B,MAAM,UAAU,aAAa;AAE7B,oCAAoC;AACpC,MAAM,YAAY,UAAU;AAErB,MAAM,SAAS;IACpB,YAAY;IACZ,KAAK,CAAC,UAAkB;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,gBAAwB,OAAT,WAAY;IAC1C;IAEA,mBAAmB;IACnB,SAAS,CAAC,SAAiB;QACzB;;QACA,QAAQ,GAAG,CAAC,AAAC,KAAY,OAAR,UAAW;IAC9B;IAEA,mBAAmB;IACnB,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,IAAI,CAAC,AAAC,MAAa,OAAR,UAAW;IAChC;IAEA,iBAAiB;IACjB,OAAO,CAAC,SAAiB;QACvB;;QACA,QAAQ,KAAK,CAAC,AAAC,KAAY,OAAR,UAAW;IAChC;IAEA,gBAAgB;IAChB,OAAO,CAAC,QAAwC;QAC9C;;QACA,MAAM,OAAO,WAAW,WAAW,MAAM,WAAW,UAAU,MAAM;QACpE,QAAQ,GAAG,CAAC,AAAC,GAAgB,OAAd,MAAK,WAAoB,OAAX,QAAO,MAAS,OAAL;IAC1C;IAEA,mBAAmB;IACnB,OAAO,CAAC,MAAc;QACpB;;QACA,QAAQ,GAAG,CAAC,AAAC,YAAgB,OAAL,MAAK,MAAI;IACnC;IAEA,eAAe;IACf,SAAS,CAAC,QAAgB;QACxB;;QACA,QAAQ,GAAG,CAAC,AAAC,cAAoB,OAAP,QAAO,MAAI;IACvC;IAEA,qBAAqB;IACrB,SAAS,CAAC,MAAc;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,cAAkB,OAAL,MAAK,MAAI;IACrC;IAEA,eAAe;IACf,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,MAAa,OAAR,UAAW;IAC/B;AACF;AAEO,MAAM,gBAAgB;AACtB,MAAM,YAAY;AAClB,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 873, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/lib/imageStorageDB.ts"],"sourcesContent":["// lib/imageStorageDB.ts\r\n// Version: 1.0.0 - 2025-11-10\r\n// Purpose: Handle large image storage using IndexedDB to avoid localStorage quota issues\r\n// IndexedDB has much higher storage limits (typically 50% of free disk space)\r\n\r\nimport { logger } from '@/utils/logger'\r\n\r\nconst DB_NAME = 'CrystalKeepsakesImages'\r\nconst DB_VERSION = 1\r\nconst STORE_NAME = 'cartImages'\r\n\r\ninterface ImageRecord {\r\n  id: string\r\n  productId: string\r\n  dataUrl: string\r\n  thumbnail: string\r\n  metadata: {\r\n    filename?: string\r\n    mimeType?: string\r\n    fileSize?: number\r\n    width?: number\r\n    height?: number\r\n    processedAt?: string\r\n    maskId?: string\r\n    maskName?: string\r\n  }\r\n  timestamp: number\r\n}\r\n\r\nclass ImageStorageDB {\r\n  private db: IDBDatabase | null = null\r\n\r\n  /**\r\n   * Initialize the database\r\n   */\r\n  async init(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION)\r\n\r\n      request.onerror = () => {\r\n        logger.error('Failed to open IndexedDB', request.error)\r\n        reject(request.error)\r\n      }\r\n\r\n      request.onsuccess = () => {\r\n        this.db = request.result\r\n        logger.info('IndexedDB initialized successfully')\r\n        resolve()\r\n      }\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result\r\n\r\n        // Create object store if it doesn't exist\r\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n          const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id' })\r\n          objectStore.createIndex('productId', 'productId', { unique: false })\r\n          objectStore.createIndex('timestamp', 'timestamp', { unique: false })\r\n          logger.info('Created IndexedDB object store')\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Ensure database is initialized\r\n   */\r\n  private async ensureDb(): Promise<IDBDatabase> {\r\n    if (!this.db) {\r\n      await this.init()\r\n    }\r\n    if (!this.db) {\r\n      throw new Error('Failed to initialize database')\r\n    }\r\n    return this.db\r\n  }\r\n\r\n  /**\r\n   * Store an image in IndexedDB\r\n   */\r\n  async storeImage(\r\n    productId: string,\r\n    dataUrl: string,\r\n    thumbnail: string,\r\n    metadata?: ImageRecord['metadata']\r\n  ): Promise<string> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n      const id = `${productId}_${Date.now()}`\r\n\r\n      const imageRecord: ImageRecord = {\r\n        id,\r\n        productId,\r\n        dataUrl,\r\n        thumbnail,\r\n        metadata: metadata || {},\r\n        timestamp: Date.now()\r\n      }\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.add(imageRecord)\r\n\r\n        request.onsuccess = () => {\r\n          logger.success('Image stored in IndexedDB', {\r\n            id,\r\n            productId,\r\n            sizeKB: Math.round(dataUrl.length / 1024)\r\n          })\r\n          resolve(id)\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to store image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error storing image', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve an image from IndexedDB\r\n   */\r\n  async getImage(id: string): Promise<ImageRecord | null> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.get(id)\r\n\r\n        request.onsuccess = () => {\r\n          const result = request.result\r\n          if (result) {\r\n            logger.info('Image retrieved from IndexedDB', { id })\r\n            resolve(result)\r\n          } else {\r\n            logger.warn('Image not found', { id })\r\n            resolve(null)\r\n          }\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to retrieve image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error retrieving image', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all images for a product\r\n   */\r\n  async getProductImages(productId: string): Promise<ImageRecord[]> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const index = objectStore.index('productId')\r\n        const request = index.getAll(productId)\r\n\r\n        request.onsuccess = () => {\r\n          const results = request.result || []\r\n          logger.info(`Retrieved ${results.length} images for product`, { productId })\r\n          resolve(results)\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to retrieve product images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error retrieving product images', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete an image from IndexedDB\r\n   */\r\n  async deleteImage(id: string): Promise<void> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.delete(id)\r\n\r\n        request.onsuccess = () => {\r\n          logger.info('Image deleted from IndexedDB', { id })\r\n          resolve()\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to delete image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error deleting image', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all images (useful for cart clear)\r\n   */\r\n  async clearAll(): Promise<void> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.clear()\r\n\r\n        request.onsuccess = () => {\r\n          logger.info('All images cleared from IndexedDB')\r\n          resolve()\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to clear images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error clearing images', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up old images (older than 7 days)\r\n   */\r\n  async cleanupOldImages(): Promise<number> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n      const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000)\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const index = objectStore.index('timestamp')\r\n        const range = IDBKeyRange.upperBound(sevenDaysAgo)\r\n        const request = index.openCursor(range)\r\n        \r\n        let deletedCount = 0\r\n\r\n        request.onsuccess = (event) => {\r\n          const cursor = (event.target as IDBRequest).result\r\n          if (cursor) {\r\n            objectStore.delete(cursor.primaryKey)\r\n            deletedCount++\r\n            cursor.continue()\r\n          } else {\r\n            logger.info(`Cleaned up ${deletedCount} old images`)\r\n            resolve(deletedCount)\r\n          }\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to cleanup old images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error cleaning up old images', error)\r\n      return 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get database statistics\r\n   */\r\n  async getStats(): Promise<{\r\n    totalImages: number\r\n    estimatedSizeMB: number\r\n  }> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const countRequest = objectStore.count()\r\n        const getAllRequest = objectStore.getAll()\r\n\r\n        countRequest.onsuccess = () => {\r\n          const count = countRequest.result\r\n\r\n          getAllRequest.onsuccess = () => {\r\n            const records = getAllRequest.result || []\r\n            const totalSize = records.reduce((sum, record) => {\r\n              return sum + (record.dataUrl?.length || 0) + (record.thumbnail?.length || 0)\r\n            }, 0)\r\n\r\n            resolve({\r\n              totalImages: count,\r\n              estimatedSizeMB: totalSize / (1024 * 1024)\r\n            })\r\n          }\r\n        }\r\n\r\n        countRequest.onerror = () => {\r\n          reject(countRequest.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error getting database stats', error)\r\n      return { totalImages: 0, estimatedSizeMB: 0 }\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const imageDB = new ImageStorageDB()\r\n\r\n// Initialize on import\r\nif (typeof window !== 'undefined') {\r\n  imageDB.init().catch((error) => {\r\n    logger.error('Failed to initialize ImageStorageDB', error)\r\n  })\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1179, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/lib/cartUtils.ts"],"sourcesContent":["// lib/cartUtils.ts\r\n// Version: 2.0.0 - 2025-11-10 - INDEXEDDB IMAGE STORAGE\r\n// Fixed: Moved image storage to IndexedDB to avoid localStorage quota issues\r\n// - Images stored in IndexedDB (50% of free disk space limit)\r\n// - Only image IDs stored in localStorage cart\r\n// - Automatic cleanup of orphaned images\r\n// - Better error handling and recovery\r\n\r\nimport { logger } from '@/utils/logger'\r\nimport { imageDB } from './imageStorageDB'\r\nimport { uploadImageStorage } from './api/upload-image.php'\r\n\r\nexport interface CartItem {\r\n  productId: string\r\n  name: string\r\n  sku: string\r\n  price: number\r\n  quantity: number\r\n  options: any\r\n  sizeDetails?: any\r\n  customImageId?: string  // Changed from customImage object to just ID\r\n  customImageMetadata?: {  // Light metadata for display\r\n    filename?: string\r\n    maskName?: string\r\n    hasImage: boolean\r\n  }\r\n  cockpit3d_id?: string\r\n  dateAdded: string\r\n}\r\n\r\n/**\r\n * Compress image to TINY thumbnail for cart display\r\n * Reduces base64 size by ~97% (e.g., 2MB -> 60KB)\r\n */\r\nasync function compressImageToThumbnail(dataUrl: string): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image()\r\n    img.onload = () => {\r\n      const canvas = document.createElement('canvas')\r\n      const MAX_SIZE = 100 // Small thumbnail size\r\n      let width = img.width\r\n      let height = img.height\r\n      \r\n      // Maintain aspect ratio\r\n      if (width > height) {\r\n        if (width > MAX_SIZE) {\r\n          height = (height * MAX_SIZE) / width\r\n          width = MAX_SIZE\r\n        }\r\n      } else {\r\n        if (height > MAX_SIZE) {\r\n          width = (width * MAX_SIZE) / height\r\n          height = MAX_SIZE\r\n        }\r\n      }\r\n      \r\n      canvas.width = width\r\n      canvas.height = height\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(img, 0, 0, width, height)\r\n      \r\n      // Lower quality JPEG for minimal size\r\n      resolve(canvas.toDataURL('image/jpeg', 0.5))\r\n    }\r\n    img.onerror = () => reject(new Error('Image compression failed'))\r\n    img.src = dataUrl\r\n  })\r\n}\r\n\r\n/**\r\n * Clean options object - remove ALL image data URLs\r\n */\r\nfunction cleanOptions(options: any): any {\r\n  if (!options) return {}\r\n  \r\n  const cleaned = { ...options }\r\n  \r\n  // Remove all image data URLs from options\r\n  delete cleaned.rawImageUrl\r\n  delete cleaned.imageUrl\r\n  delete cleaned.maskedImageUrl\r\n  delete cleaned.dataUrl\r\n  delete cleaned.customImage\r\n  \r\n  // Keep only essential metadata\r\n  return {\r\n    size: cleaned.size,\r\n    background: cleaned.background,\r\n    lightBase: cleaned.lightBase,\r\n    giftStand: cleaned.giftStand,\r\n    customText: cleaned.customText,\r\n    // Only keep image filenames, not data URLs\r\n    imageFilename: cleaned.imageFilename,\r\n    maskName: cleaned.maskName\r\n  }\r\n}\r\n\r\n/**\r\n * Add item to cart with IndexedDB image storage\r\n */\r\nexport async function addToCart(item: CartItem | any): Promise<void> {\r\n  logger.order('Adding item to cart', {\r\n    productId: item.productId,\r\n    hasCustomImage: !!item.customImage?.dataUrl || !!item.options?.maskedImageUrl\r\n  })\r\n  \r\n  try {\r\n    const cart = getCart()\r\n    let customImageId: string | undefined\r\n    let customImageMetadata: CartItem['customImageMetadata'] | undefined\r\n    \r\n    // Handle custom image storage in IndexedDB\r\n    const imageDataUrl = item.customImage?.dataUrl || item.options?.maskedImageUrl\r\n    if (imageDataUrl) {\r\n      try {\r\n        // Compress thumbnail\r\n        const thumbnail = await compressImageToThumbnail(imageDataUrl)\r\n        \r\n        // Store full image and thumbnail in IndexedDB\r\n        customImageId = await imageDB.storeImage(\r\n          item.productId,\r\n          imageDataUrl,\r\n          thumbnail,\r\n          {\r\n            filename: item.customImage?.filename || item.options?.imageFilename,\r\n            mimeType: item.customImage?.mimeType || 'image/png',\r\n            fileSize: item.customImage?.fileSize || imageDataUrl.length,\r\n            width: item.customImage?.width,\r\n            height: item.customImage?.height,\r\n            processedAt: item.customImage?.processedAt || new Date().toISOString(),\r\n            maskId: item.customImage?.maskId || item.options?.maskId,\r\n            maskName: item.customImage?.maskName || item.options?.maskName\r\n          }\r\n        )\r\n        \r\n        customImageMetadata = {\r\n          filename: item.customImage?.filename || item.options?.imageFilename,\r\n          maskName: item.customImage?.maskName || item.options?.maskName,\r\n          hasImage: true\r\n        }\r\n        \r\n        logger.success('Image stored in IndexedDB', {\r\n          imageId: customImageId,\r\n          originalSizeKB: Math.round(imageDataUrl.length / 1024),\r\n          thumbnailSizeKB: Math.round(thumbnail.length / 1024)\r\n        })\r\n      } catch (error) {\r\n        logger.error('Failed to store image in IndexedDB', error)\r\n        // Continue without image rather than fail entire add\r\n        customImageId = undefined\r\n        customImageMetadata = { hasImage: false }\r\n      }\r\n    }\r\n    \r\n    // Clean options to remove any image data\r\n    const cleanedOptions = cleanOptions(item.options)\r\n    \r\n    // Create cart item with just image ID reference\r\n    const cartItem: CartItem = {\r\n      productId: item.productId,\r\n      name: item.name,\r\n      sku: item.sku,\r\n      price: item.price || item.totalPrice,\r\n      quantity: item.quantity,\r\n      options: cleanedOptions,\r\n      sizeDetails: item.size || item.sizeDetails,\r\n      customImageId,\r\n      customImageMetadata,\r\n      cockpit3d_id: item.cockpit3d_id,\r\n      dateAdded: item.dateAdded || new Date().toISOString()\r\n    }\r\n    \r\n    cart.push(cartItem)\r\n    saveCart(cart)\r\n    \r\n    // Clean up old images periodically\r\n    if (Math.random() < 0.1) { // 10% chance on each add\r\n      imageDB.cleanupOldImages().catch(err => \r\n        logger.warn('Background image cleanup failed', err)\r\n      )\r\n    }\r\n    \r\n    logger.success('Item added to cart', { \r\n      totalItems: cart.length,\r\n      hasImage: !!customImageId\r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to add item to cart', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get cart from localStorage\r\n */\r\nexport function getCart(): CartItem[] {\r\n  try {\r\n    const cartData = localStorage.getItem('cart')\r\n    return cartData ? JSON.parse(cartData) : []\r\n  } catch (error) {\r\n    logger.error('Failed to read cart', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get cart with images loaded from IndexedDB\r\n */\r\nexport async function getCartWithImages(): Promise<Array<CartItem & { \r\n  customImage?: { \r\n    dataUrl: string\r\n    thumbnail: string\r\n    metadata: any\r\n  } \r\n}>> {\r\n  const cart = getCart()\r\n  \r\n  // Load images from IndexedDB\r\n  const cartWithImages = await Promise.all(\r\n    cart.map(async (item) => {\r\n      if (item.customImageId) {\r\n        try {\r\n          const imageRecord = await imageDB.getImage(item.customImageId)\r\n          if (imageRecord) {\r\n            return {\r\n              ...item,\r\n              customImage: {\r\n                dataUrl: imageRecord.dataUrl,\r\n                thumbnail: imageRecord.thumbnail,\r\n                metadata: imageRecord.metadata\r\n              }\r\n            }\r\n          }\r\n        } catch (error) {\r\n          logger.warn(`Failed to load image for cart item`, { \r\n            productId: item.productId,\r\n            imageId: item.customImageId,\r\n            error \r\n          })\r\n        }\r\n      }\r\n      return item\r\n    })\r\n  )\r\n  \r\n  return cartWithImages\r\n}\r\n\r\n/**\r\n * Save cart to localStorage (without images)\r\n */\r\nexport function saveCart(cart: CartItem[]): void {\r\n  try {\r\n    const cartJson = JSON.stringify(cart)\r\n    const sizeKB = (cartJson.length / 1024).toFixed(2)\r\n    \r\n    logger.info('Saving cart to localStorage', { \r\n      items: cart.length, \r\n      sizeKB,\r\n      hasImages: cart.filter(item => item.customImageId).length\r\n    })\r\n    \r\n    localStorage.setItem('cart', cartJson)\r\n    \r\n    // Dispatch custom event to notify all listeners\r\n    const event = new CustomEvent('cartUpdated', { \r\n      detail: { \r\n        itemCount: cart.length,\r\n        totalItems: cart.reduce((sum, item) => sum + item.quantity, 0)\r\n      } \r\n    })\r\n    window.dispatchEvent(event)\r\n    \r\n  } catch (error: any) {\r\n    logger.error('Failed to save cart', error)\r\n    \r\n    if (error.name === 'QuotaExceededError') {\r\n      // This should be rare now since images are in IndexedDB\r\n      // Try clearing some old data\r\n      try {\r\n        cleanupLocalStorage()\r\n        localStorage.setItem('cart', JSON.stringify(cart))\r\n        logger.warn('Cart saved after cleanup')\r\n      } catch (fallbackError) {\r\n        throw new Error('Unable to save cart. Please clear browser data.')\r\n      }\r\n    } else {\r\n      throw error\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Remove item from cart by index\r\n */\r\nexport async function removeFromCart(index: number): Promise<CartItem[]> {\r\n  const cart = getCart()\r\n  const removedItem = cart[index]\r\n  \r\n  // Delete associated image from IndexedDB\r\n  if (removedItem?.customImageId) {\r\n    try {\r\n      await imageDB.deleteImage(removedItem.customImageId)\r\n      logger.info('Deleted image from IndexedDB', { \r\n        imageId: removedItem.customImageId \r\n      })\r\n    } catch (error) {\r\n      logger.warn('Failed to delete image from IndexedDB', error)\r\n    }\r\n  }\r\n  \r\n  cart.splice(index, 1)\r\n  saveCart(cart)\r\n  return cart\r\n}\r\n\r\n/**\r\n * Clear entire cart and all images\r\n */\r\nexport async function clearCart(): Promise<void> {\r\n  localStorage.removeItem('cart')\r\n  \r\n  // Clear all images from IndexedDB\r\n  try {\r\n    await imageDB.clearAll()\r\n    logger.info('Cleared all images from IndexedDB')\r\n  } catch (error) {\r\n    logger.warn('Failed to clear images from IndexedDB', error)\r\n  }\r\n  \r\n  window.dispatchEvent(new CustomEvent('cartUpdated', { \r\n    detail: { itemCount: 0, totalItems: 0 } \r\n  }))\r\n}\r\n\r\n/**\r\n * Get total item count\r\n */\r\nexport function getCartItemCount(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + item.quantity, 0)\r\n}\r\n\r\n/**\r\n * Get cart total price\r\n */\r\nexport function getCartTotal(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)\r\n}\r\n\r\n/**\r\n * Check localStorage health\r\n */\r\nexport function checkStorageHealth(): { \r\n  isHealthy: boolean\r\n  usedSpace: number\r\n  totalSpace: number\r\n  percentUsed: number\r\n  message?: string\r\n} {\r\n  try {\r\n    let totalSize = 0\r\n    for (let key in localStorage) {\r\n      if (localStorage.hasOwnProperty(key)) {\r\n        totalSize += localStorage[key].length + key.length\r\n      }\r\n    }\r\n    \r\n    // Most browsers have 5MB limit\r\n    const STORAGE_LIMIT = 5242880\r\n    const percentUsed = (totalSize / STORAGE_LIMIT) * 100\r\n    \r\n    logger.info('Storage health check', {\r\n      usedKB: (totalSize / 1024).toFixed(2),\r\n      percentUsed: percentUsed.toFixed(1) + '%'\r\n    })\r\n    \r\n    return {\r\n      isHealthy: percentUsed < 90,\r\n      usedSpace: totalSize,\r\n      totalSpace: STORAGE_LIMIT,\r\n      percentUsed,\r\n      message: percentUsed > 80 ? 'Storage nearly full' : undefined\r\n    }\r\n    \r\n  } catch (error) {\r\n    logger.error('Storage health check failed', error)\r\n    return {\r\n      isHealthy: false,\r\n      usedSpace: 0,\r\n      totalSpace: 0,\r\n      percentUsed: 100,\r\n      message: 'Storage check failed'\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up unnecessary data from localStorage\r\n */\r\nfunction cleanupLocalStorage(): void {\r\n  try {\r\n    // Remove old/temporary data\r\n    const keysToCheck = Object.keys(localStorage)\r\n    keysToCheck.forEach(key => {\r\n      // Remove old temporary data\r\n      if (key.startsWith('temp_') || key.startsWith('old_')) {\r\n        localStorage.removeItem(key)\r\n      }\r\n    })\r\n    logger.info('Cleaned up localStorage')\r\n  } catch (error) {\r\n    logger.error('localStorage cleanup failed', error)\r\n  }\r\n}\r\n\r\n/**\r\n * Get IndexedDB stats\r\n */\r\nexport async function getImageStorageStats() {\r\n  try {\r\n    const stats = await imageDB.getStats()\r\n    return {\r\n      ...stats,\r\n      storageHealth: checkStorageHealth()\r\n    }\r\n  } catch (error) {\r\n    logger.error('Failed to get storage stats', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Estimate size of data to be stored (backward compatibility)\r\n */\r\nexport function estimateSize(data: any): number {\r\n  try {\r\n    return JSON.stringify(data).length\r\n  } catch (error) {\r\n    logger.error('Failed to estimate data size', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n/**\r\n * Store full-resolution image (backward compatibility)\r\n * Now uses IndexedDB instead of sessionStorage\r\n */\r\nexport async function storeFullResImage(productId: string, dataUrl: string): Promise<void> {\r\n  try {\r\n    // Create a thumbnail for storage\r\n    const thumbnail = await compressImageToThumbnail(dataUrl)\r\n    \r\n    // Store in IndexedDB\r\n    await imageDB.storeImage(\r\n      productId,\r\n      dataUrl,\r\n      thumbnail,\r\n      {\r\n        processedAt: new Date().toISOString()\r\n      }\r\n    )\r\n    \r\n    logger.info('Full-res image stored in IndexedDB', { \r\n      productId, \r\n      sizeKB: (dataUrl.length / 1024).toFixed(2) \r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to store full-res image', error)\r\n    \r\n    // Fallback to sessionStorage for backward compatibility\r\n    try {\r\n      sessionStorage.setItem(`fullimg_${productId}`, dataUrl)\r\n      logger.warn('Fell back to sessionStorage for image storage')\r\n    } catch (e) {\r\n      logger.error('All image storage methods failed', e)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieve full-resolution image (backward compatibility)\r\n * Checks both IndexedDB and sessionStorage\r\n */\r\nexport async function getFullResImage(productId: string): Promise<string | null> {\r\n  try {\r\n    // First try IndexedDB\r\n    const images = await imageDB.getProductImages(productId)\r\n    if (images.length > 0) {\r\n      return images[0].dataUrl\r\n    }\r\n    \r\n    // Fallback to sessionStorage\r\n    const sessionImage = sessionStorage.getItem(`fullimg_${productId}`)\r\n    if (sessionImage) {\r\n      logger.info('Retrieved image from sessionStorage fallback')\r\n      return sessionImage\r\n    }\r\n    \r\n    return null\r\n  } catch (error) {\r\n    logger.error('Could not retrieve full-res image', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate old cart format to new format (for backwards compatibility)\r\n */\r\nexport async function migrateOldCart(): Promise<void> {\r\n  try {\r\n    const cart = getCart()\r\n    let needsMigration = false\r\n    \r\n    const migratedCart = await Promise.all(\r\n      cart.map(async (item: any) => {\r\n        // Check if item has old format with embedded image\r\n        if (item.customImage?.dataUrl && !item.customImageId) {\r\n          needsMigration = true\r\n          \r\n          try {\r\n            // Store image in IndexedDB\r\n            const thumbnail = await compressImageToThumbnail(item.customImage.dataUrl)\r\n            const imageId = await imageDB.storeImage(\r\n              item.productId,\r\n              item.customImage.dataUrl,\r\n              thumbnail,\r\n              item.customImage\r\n            )\r\n            \r\n            // Return migrated item\r\n            return {\r\n              ...item,\r\n              customImageId: imageId,\r\n              customImageMetadata: {\r\n                filename: item.customImage.filename,\r\n                maskName: item.customImage.maskName,\r\n                hasImage: true\r\n              },\r\n              customImage: undefined // Remove embedded image\r\n            }\r\n          } catch (error) {\r\n            logger.warn('Failed to migrate image for item', { \r\n              productId: item.productId, \r\n              error \r\n            })\r\n            return {\r\n              ...item,\r\n              customImage: undefined\r\n            }\r\n          }\r\n        }\r\n        return item\r\n      })\r\n    )\r\n    \r\n    if (needsMigration) {\r\n      saveCart(migratedCart)\r\n      logger.info('Cart migrated to new format')\r\n    }\r\n  } catch (error) {\r\n    logger.error('Cart migration failed', error)\r\n  }\r\n}\r\n\r\n// Auto-migrate on load\r\nif (typeof window !== 'undefined') {\r\n  migrateOldCart().catch(err => \r\n    logger.warn('Auto-migration failed', err)\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1630, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/components/ProductDetailClient.tsx"],"sourcesContent":["// components/ProductDetailClient.tsx\r\n// Version: 2.3.0 - 2025-11-05 - CART ADD FIX\r\n// ‚úÖ Fixed: Storage property names (used‚ÜíusedSpace, limit‚ÜítotalSpace)\r\n// ‚úÖ Cart add to cart now works - NaN error resolved\r\n// Previous: Storage check for high-res PNG files\r\n'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useParams, useRouter } from 'next/navigation'\r\nimport Image from 'next/image'\r\nimport Link from 'next/link'\r\nimport ImageEditor from '@/components/ImageEditor'\r\nimport type { CustomImage, OrderLineItem, SizeDetails, ProductOption } from '@/types/orderTypes'\r\nimport { logger } from '@/utils/logger'\r\nimport { addToCart, checkStorageHealth, storeFullResImage } from '@/lib/cartUtils'\r\n\r\nimport '../app/css/modal.css'\r\nimport '../app/css/product-options.css'\r\n\r\n// Environment\r\nconst ENV_MODE = process.env.NEXT_PUBLIC_ENV_MODE || 'development'\r\nconst isDevelopment = ENV_MODE === 'development' || ENV_MODE === 'testing'\r\n\r\n// TypeScript Interfaces\r\ninterface Size {\r\n  id: string\r\n  name: string\r\n  price: number\r\n}\r\n\r\ninterface LightBase {\r\n  id: string\r\n  name: string\r\n  price: number | null\r\n}\r\n\r\ninterface BackgroundOption {\r\n  id: string\r\n  name: string\r\n  price: number\r\n}\r\n\r\ninterface TextOption {\r\n  id: string\r\n  name: string\r\n  price: number\r\n}\r\n\r\ninterface ProductImage {\r\n  src: string\r\n  isMain: boolean\r\n}\r\n\r\ninterface Product {\r\n  id: number | string\r\n  name: string\r\n  slug: string\r\n  sku: string\r\n  basePrice: number\r\n  description: string\r\n  longDescription?: string\r\n  images: ProductImage[]\r\n  sizes?: Size[]\r\n  lightBases?: LightBase[]\r\n  backgroundOptions?: BackgroundOption[]\r\n  textOptions?: TextOption[]\r\n  requiresImage?: boolean\r\n  categories?: string[]\r\n  maskImageUrl?: string\r\n  cockpit3d_id?: string\r\n}\r\n\r\nexport default function ProductDetailClient() {\r\n  const params = useParams()\r\n  const router = useRouter()\r\n  \r\n  // Product State\r\n  const [product, setProduct] = useState<Product | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string>('')\r\n  \r\n  // Selection State\r\n  const [selectedSize, setSelectedSize] = useState<Size | null>(null)\r\n  const [selectedLightBase, setSelectedLightBase] = useState<LightBase | null>(null)\r\n  const [selectedBackground, setSelectedBackground] = useState<BackgroundOption | null>(null)\r\n  const [selectedTextOption, setSelectedTextOption] = useState<TextOption | null>(null)\r\n  const [customText, setCustomText] = useState({ line1: '', line2: '' })\r\n  const [quantity, setQuantity] = useState(1)\r\n  \r\n  // Image State\r\n  const [uploadedImage, setUploadedImage] = useState<string | null>(null)\r\n  const [originalFileName, setOriginalFileName] = useState<string>('')\r\n  const [finalMaskedImage, setFinalMaskedImage] = useState<string | null>(null)\r\n  const [showEditor, setShowEditor] = useState(false)\r\n  \r\n  // UI State\r\n  const [addingToCart, setAddingToCart] = useState(false)\r\n  const [successMessage, setSuccessMessage] = useState<string>('')\r\n  const [errors, setErrors] = useState<Record<string, string>>({})\r\n\r\n  // Fetch product on mount\r\n  useEffect(() => {\r\n    if (params.slug) {\r\n      fetchProduct(params.slug as string)\r\n    }\r\n  }, [params.slug])\r\n\r\n  /**\r\n   * Fetch product data - READ FROM CACHED FILE\r\n   */\r\n  const fetchProduct = async (slug: string) => {\r\n    try {\r\n      logger.info('Fetching product', { slug, envMode: ENV_MODE })\r\n      \r\n      // Import from cached file directly\r\n      const { cockpit3dProducts } = await import('@/data/cockpit3d-products.js')\r\n      \r\n      logger.info(`Loaded ${cockpit3dProducts.length} products from cache`)\r\n      \r\n      // Find product by slug\r\n      const foundProduct = cockpit3dProducts.find((p: Product) => p.slug === slug)\r\n      \r\n      if (!foundProduct) {\r\n        throw new Error('Product not found')\r\n      }\r\n      \r\n      setProduct(foundProduct)\r\n      \r\n      // Set default selections\r\n      if (foundProduct.sizes && foundProduct.sizes.length > 0) {\r\n        setSelectedSize(foundProduct.sizes[0])\r\n      }\r\n      \r\n      if (foundProduct.lightBases && foundProduct.lightBases.length > 0) {\r\n        setSelectedLightBase(foundProduct.lightBases[0])\r\n      }\r\n      \r\n      if (foundProduct.backgroundOptions && foundProduct.backgroundOptions.length > 0) {\r\n        setSelectedBackground(foundProduct.backgroundOptions[0])\r\n      }\r\n      \r\n      if (foundProduct.textOptions && foundProduct.textOptions.length > 0) {\r\n        setSelectedTextOption(foundProduct.textOptions[0])\r\n      }\r\n      \r\n      logger.success('Product loaded', { name: foundProduct.name, id: foundProduct.id })\r\n      \r\n    } catch (err: any) {\r\n      logger.error('Failed to fetch product', err)\r\n      setError(err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle image file upload\r\n   */\r\n  const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0]\r\n    if (!file) return\r\n\r\n    // Store filename\r\n    setOriginalFileName(file.name)\r\n\r\n    // Validate\r\n    if (file.size > 5 * 1024 * 1024) {\r\n      setErrors({ ...errors, image: 'Image must be less than 5MB' })\r\n      return\r\n    }\r\n\r\n    if (!['image/jpeg', 'image/png', 'image/gif'].includes(file.type)) {\r\n      setErrors({ ...errors, image: 'Please upload JPG, PNG, or GIF' })\r\n      return\r\n    }\r\n\r\n    // Read and show editor immediately\r\n    const reader = new FileReader()\r\n    reader.onload = (e) => {\r\n      const dataUrl = e.target?.result as string\r\n      setUploadedImage(dataUrl)\r\n      setShowEditor(true)\r\n    }\r\n    reader.readAsDataURL(file)\r\n  }\r\n\r\n  /**\r\n   * Handle save from ImageEditor - THIS IS CRITICAL\r\n   */\r\n  const handleImageEditorSave = (compressedImage: string) => {\r\n    logger.info('Image saved from editor', { \r\n      size: compressedImage.length \r\n    })\r\n    \r\n    // Save the masked/compressed image\r\n    setFinalMaskedImage(compressedImage)\r\n    setShowEditor(false)\r\n    \r\n    // Clear any errors\r\n    setErrors(prev => {\r\n      const newErrors = { ...prev }\r\n      delete newErrors.image\r\n      delete newErrors.finalImage\r\n      return newErrors\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Form validation\r\n   */\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Record<string, string> = {}\r\n    \r\n    // Validate size if product has sizes\r\n    if (product?.sizes && product.sizes.length > 0 && !selectedSize) {\r\n      newErrors.size = 'Please select a size'\r\n    }\r\n    \r\n    // Validate image if product requires it\r\n    if (product?.requiresImage) {\r\n      if (!uploadedImage) {\r\n        newErrors.image = 'Please upload an image'\r\n      } else if (!finalMaskedImage) {\r\n        newErrors.finalImage = 'Please save your edited image before adding to cart'\r\n      }\r\n    }\r\n    \r\n    setErrors(newErrors)\r\n    return Object.keys(newErrors).length === 0\r\n  }\r\n\r\n  /**\r\n   * Calculate total price\r\n   */\r\n  const calculateTotal = (): number => {\r\n    let total = selectedSize?.price || product?.basePrice || 0\r\n    \r\n    if (selectedLightBase?.price) total += selectedLightBase.price\r\n    if (selectedBackground?.price) total += selectedBackground.price\r\n    if (selectedTextOption?.price) total += selectedTextOption.price\r\n    \r\n    return total * quantity\r\n  }\r\n  \r\n  /**\r\n   * Calculate options price (for order line item)\r\n   */\r\n  const calculateOptionsPrice = (): number => {\r\n    let optionsPrice = 0\r\n    if (selectedLightBase?.price) optionsPrice += selectedLightBase.price\r\n    if (selectedBackground?.price) optionsPrice += selectedBackground.price\r\n    if (selectedTextOption?.price) optionsPrice += selectedTextOption.price\r\n    return optionsPrice\r\n  }\r\n\r\n  /**\r\n   * Convert selections to ProductOption array\r\n   */\r\n  const buildProductOptions = (): ProductOption[] => {\r\n    const options: ProductOption[] = []\r\n    \r\n    if (selectedLightBase) {\r\n      options.push({\r\n        category: 'lightBase',\r\n        optionId: selectedLightBase.id,\r\n        name: selectedLightBase.name,\r\n        value: selectedLightBase.name,\r\n        priceModifier: selectedLightBase.price || 0\r\n      })\r\n    }\r\n    \r\n    if (selectedBackground) {\r\n      options.push({\r\n        category: 'background',\r\n        optionId: selectedBackground.id,\r\n        name: selectedBackground.name,\r\n        value: selectedBackground.name,\r\n        priceModifier: selectedBackground.price\r\n      })\r\n    }\r\n    \r\n    if (selectedTextOption) {\r\n      options.push({\r\n        category: 'textOption',\r\n        optionId: selectedTextOption.id,\r\n        name: selectedTextOption.name,\r\n        value: selectedTextOption.name,\r\n        priceModifier: selectedTextOption.price\r\n      })\r\n    }\r\n    \r\n    // ‚úÖ ADD: Custom text as separate options\r\n    if (customText.line1) {\r\n      options.push({\r\n        category: 'customText',\r\n        optionId: 'text_line1',\r\n        name: 'Text Line 1',\r\n        value: customText.line1,\r\n        priceModifier: 0\r\n      })\r\n    }\r\n    \r\n    if (customText.line2) {\r\n      options.push({\r\n        category: 'customText',\r\n        optionId: 'text_line2',\r\n        name: 'Text Line 2',\r\n        value: customText.line2,\r\n        priceModifier: 0\r\n      })\r\n    }\r\n    \r\n    return options  // ‚úÖ NOW INCLUDES ALL OPTIONS\r\n  }\r\n\r\n  /**\r\n   * Add to cart with full order structure\r\n   */\r\n  const handleAddToCart = async () => {\r\n    // Validate first\r\n    if (!validateForm()) {\r\n      logger.warn('Form validation failed', errors)\r\n      return\r\n    }\r\n\r\n    setAddingToCart(true)\r\n    setError('')\r\n    setSuccessMessage('')\r\n\r\n    try {\r\n      if (!product) {\r\n        throw new Error('Product not loaded')\r\n      }\r\n\r\n      // Build CustomImage object if image exists\r\n      let customImage: CustomImage | undefined\r\n\r\n      if (finalMaskedImage) {\r\n        const img = new window.Image()\r\n        img.src = finalMaskedImage\r\n        \r\n        // ‚úÖ Store BOTH images - original for display, masked for Cockpit3D\r\n        if (uploadedImage) {\r\n          storeFullResImage(product.id.toString(), uploadedImage)\r\n        }\r\n        \r\n        await new Promise(resolve => { img.onload = resolve })\r\n        \r\n        customImage = {\r\n          dataUrl: finalMaskedImage,  // For Cockpit3D order\r\n          originalDataUrl: uploadedImage,  // ‚úÖ ADD: For cart display\r\n          filename: originalFileName || `product-${product.id}-${Date.now()}.png`,\r\n          mimeType: 'image/png',\r\n          fileSize: finalMaskedImage.length,\r\n          width: img.width,\r\n          height: img.height,\r\n          processedAt: new Date().toISOString(),\r\n          maskId: product.maskImageUrl,\r\n          maskName: 'Product Mask'\r\n        }\r\n      }\r\n      \r\n      // Build size details\r\n      const sizeDetails: SizeDetails = {\r\n        sizeId: selectedSize?.id || 'default',\r\n        sizeName: selectedSize?.name || 'Default Size',\r\n        basePrice: selectedSize?.price || product.basePrice\r\n      }\r\n      \r\n      // Build product options\r\n      const productOptions = buildProductOptions()\r\n      \r\n      // Build custom text string\r\n      const customTextString = customText.line1 || customText.line2\r\n        ? `${customText.line1}${customText.line2 ? '\\n' + customText.line2 : ''}`\r\n        : undefined\r\n      \r\n      // Calculate prices\r\n      const optionsPrice = calculateOptionsPrice()\r\n      const totalPrice = calculateTotal()\r\n      \r\n      // Create line item with COMPLETE order data structure\r\n      const lineItem: OrderLineItem = {\r\n        lineItemId: `line_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        productId: String(product.id),\r\n        cockpit3d_id: product.cockpit3d_id || String(product.id),\r\n        name: product.name,\r\n        sku: product.sku,\r\n        basePrice: selectedSize?.price || product.basePrice,\r\n        optionsPrice: optionsPrice,\r\n        totalPrice: totalPrice,\r\n        quantity: quantity,\r\n        size: sizeDetails,\r\n        options: productOptions,\r\n        customImage: customImage,  // ‚Üê THE MASKED IMAGE\r\n        customText: customTextString ? { text: customTextString } : undefined,\r\n        dateAdded: new Date().toISOString(),\r\n        lastModified: new Date().toISOString()\r\n      }\r\n      \r\n      logger.order('Adding item to cart', {\r\n        productId: lineItem.productId,\r\n        name: lineItem.name,\r\n        quantity: lineItem.quantity,\r\n        totalPrice: lineItem.totalPrice,\r\n        hasCustomImage: !!lineItem.customImage,\r\n        hasCustomText: !!lineItem.customText,\r\n        imageSize: lineItem.customImage ? lineItem.customImage.fileSize : 0\r\n      })\r\n      \r\n      // Add to cart using cartUtils\r\n      try {\r\n        await addToCart(lineItem)\r\n\r\n       // addToCart(lineItem)\r\n        logger.success('Item successfully added to cart')\r\n      } catch (cartError: any) {\r\n        logger.error('Cart add failed', cartError)\r\n        throw new Error(`Failed to add to cart: ${cartError.message}`)\r\n      }\r\n      \r\n      // Success!\r\n      setSuccessMessage(`Added ${quantity} ${product.name} to cart!`)\r\n      \r\n      // Reset form and redirect\r\n      setTimeout(() => {\r\n        setQuantity(1)\r\n        setCustomText({ line1: '', line2: '' })\r\n        setUploadedImage(null)\r\n        setFinalMaskedImage(null)\r\n        \r\n        router.push('/cart')\r\n      }, 1500)\r\n      \r\n    } catch (error: any) {\r\n      logger.error('Failed to add to cart', error)\r\n      setError(error.message || 'Failed to add to cart')\r\n    } finally {\r\n      setAddingToCart(false)\r\n    }\r\n  }\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block w-12 h-12 border-4 border-[var(--brand-400)] border-t-transparent rounded-full animate-spin mb-4\"></div>\r\n          <p className=\"text-gray-400\">Loading product...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Error state\r\n  if (error && !product) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-12\">\r\n        <div className=\"bg-red-900/20 border border-red-500 rounded-lg p-6 max-w-2xl mx-auto\">\r\n          <h2 className=\"text-2xl font-bold text-red-400 mb-2\">Product Not Found</h2>\r\n          <p className=\"text-gray-300 mb-4\">{error}</p>\r\n          <Link href=\"/products\" className=\"btn btn-primary px-6 py-2 rounded-lg\">\r\n            Browse All Products\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (!product) return null\r\n\r\n  const mainImage = product.images.find(img => img.isMain) || product.images[0]\r\n\r\n  return (    \r\n    <div className=\"min-h-screen\"> \r\n\r\n      <nav className=\"breadcrumbs py-4\">\r\n        <div className=\"container mx-auto px-4\">\r\n          <Link href=\"/\" className=\"hover:text-brand-400 transition-colors\">Home</Link>  \r\n          <span className=\"mx-2 text-gray-600\">/</span>\r\n          <Link href=\"/products\" className=\"hover:text-brand-400 transition-colors\">Products</Link> \r\n          <span className=\"mx-2 text-gray-600\">/</span> \r\n          <span className=\"text-text-tertiary\">{product.name}</span>\r\n        </div>\r\n      </nav>        \r\n      \r\n      <div className=\"container mx-auto py-4\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8\">\r\n          \r\n          {/* Product Image */}\r\n          <div>\r\n            {finalMaskedImage ? (\r\n              // STAGE 1: Show user's uploaded/edited image\r\n              <div className=\"sticky top-[var(--header-height)] z-1 mt-4\">\r\n                <Image\r\n                  src={finalMaskedImage} \r\n                  alt=\"Customer Preview\" \r\n                  className=\"w-full max-w-xs rounded-lg border border-[var(--surface-700)]\"\r\n                  width={1024}\r\n                  height={1024}\r\n                />\r\n                <div className=\"mt-2 flex gap-2\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowEditor(true)}\r\n                    className=\"btn btn-secondary px-4 py-3 rounded-md cursor-pointer\"\r\n                  >\r\n                    Edit Image Again\r\n                  </button>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setFinalMaskedImage(null)}\r\n                    className=\"btn btn-secondary px-4 py-3 rounded-md cursor-pointer\"\r\n                  >\r\n                    Remove & Show Product\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            ) : product.images && product.images.length > 1 ? (\r\n              // STAGE 2: Show gallery if multiple images exist\r\n              <div className=\"sticky top-[var(--header-height)]\">\r\n                <ProductGallery images={product.images} />\r\n              </div>\r\n            ) : (\r\n            // STAGE 3: Show single product image as fallback\r\n              <div className=\"sticky top-[var(--header-height)]\">\r\n                <Image\r\n                  src={mainImage.src}\r\n                  alt={product.name}\r\n                  width={1024}\r\n                  height={1024}\r\n                  className=\"w-full h-auto rounded-lg\"\r\n                />\r\n              </div>\r\n            )}\r\n            \r\n          </div>\r\n\r\n          {/* Product Options Form */}\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold mb-4\">{product.name}</h1>\r\n            <p className=\"text-gray-400 mb-6\">{product.description}</p>\r\n            \r\n            <div className=\"text-2xl font-bold mb-6\">\r\n              ${calculateTotal().toFixed(2)}\r\n            </div>\r\n\r\n            {/* Success Message */}\r\n            {successMessage && (\r\n              <div className=\"bg-green-900/20 border border-green-500 rounded-lg p-4 mb-6\">\r\n                <p className=\"text-green-400\">{successMessage}</p>\r\n              </div>\r\n            )}\r\n\r\n            {/* Error Message */}\r\n            {error && (\r\n              <div className=\"bg-red-900/20 border border-red-500 rounded-lg p-4 mb-6\">\r\n                <p className=\"text-red-400\">{error}</p>\r\n              </div>\r\n            )}\r\n            \r\n            {/* Image Upload */}\r\n            {product.requiresImage && (\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-xl font-medium mb-2\">Upload Image *</label>\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/jpeg,image/png,image/gif\"\r\n                  onChange={handleImageUpload}\r\n                  className=\"block w-full text-sm text-gray-400 border-[var(--primary)] border-1 rounded-lg\r\n                    file:mr-4 file:py-2 file:px-4\r\n                    file:rounded-md file:border-0\r\n                    file:text-sm file:font-semibold\r\n                    file:bg-[var(--primary)] file:text-white\r\n                    hover:file:bg-[var(--brand-600)]\r\n                    file:cursor-pointer cursor-pointer\"\r\n                />\r\n                {errors.image && (\r\n                  <p className=\"text-red-400 text-sm mt-2\">{errors.image}</p>\r\n                )}\r\n                {errors.finalImage && (\r\n                  <p className=\"text-red-400 text-sm mt-2\">{errors.finalImage}</p>\r\n                )}\r\n                <div className=\"mt-4 rounded-xl border border-orange-500/30 bg-orange-500/5 px-3 py-1 text-left\">\r\n                  <p className=\"text-sm mt-2\"><strong>Image Requirements:</strong></p>\r\n                  <ul className=\"list-inside list-disc font-thin text-sm p-2\">\r\n                    <li>File type: JPG, PNG, or GIF</li>\r\n                    <li>Maximum size: 5MB</li>\r\n                    <li>Minimum dimensions: 500x500 pixels</li>\r\n                    <li>Higher resolution recommended for best results</li>\r\n                  </ul>\r\n                </div> \r\n               \r\n              </div>\r\n            )}\r\n\r\n            {/* Size Selection */}\r\n            {product.sizes && product.sizes.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-xl font-medium mb-2\">Size *</label>\r\n                <div className=\"space-y-2\">\r\n                  {product.sizes.map(size => (\r\n                    <label key={size.id} className=\"crystal-radio flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"size\"\r\n                        value={size.id}\r\n                        checked={selectedSize?.id === size.id}\r\n                        onChange={() => setSelectedSize(size)}\r\n                        className=\"mr-3\"\r\n                      />\r\n                      <span>\r\n                        {size.name} {size.price > 0 && `(+$${size.price})`}\r\n                      </span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n                {errors.size && (\r\n                  <p className=\"text-red-400 text-sm mt-2\">{errors.size}</p>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/* Background Options */}\r\n            {product.backgroundOptions && product.backgroundOptions.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-xl font-medium mb-2\">Background</label>\r\n                <div className=\"space-y-2\">\r\n                  {product.backgroundOptions.map(bg => (\r\n                    <label key={bg.id} className=\"flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"background\"\r\n                        value={bg.id}\r\n                        checked={selectedBackground?.id === bg.id}\r\n                        onChange={() => setSelectedBackground(bg)}\r\n                        className=\"mr-3\"\r\n                      />\r\n                      <span>\r\n                        {bg.name} {bg.price > 0 && `(+$${bg.price})`}\r\n                      </span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Light Base Options */}\r\n            {product.lightBases && product.lightBases.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-xl font-medium mb-2\">Light Base</label>\r\n                <div className=\"space-y-2\">\r\n                  {product.lightBases.map(base => (\r\n                    <label key={base.id} className=\"flex items-center cursor-pointer\">\r\n                      <input\r\n                        type=\"radio\"\r\n                        name=\"lightBase\"\r\n                        value={base.id}\r\n                        checked={selectedLightBase?.id === base.id}\r\n                        onChange={() => setSelectedLightBase(base)}\r\n                        className=\"mr-3\"\r\n                      />\r\n                      <span>\r\n                        {base.name} {base.price && base.price > 0 && `(+$${base.price})`}\r\n                      </span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Custom Text */}\r\n            {product.textOptions && product.textOptions.length > 0 && (\r\n              <div className=\"mb-6\">\r\n                <label className=\"block text-sm font-medium mb-2\">Custom Text (Optional)</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Line 1\"\r\n                  value={customText.line1}\r\n                  onChange={(e) => setCustomText({ ...customText, line1: e.target.value })}\r\n                  className=\"w-full px-4 py-2 rounded-lg bg-[var(--surface-800)] border border-[var(--surface-700)] mb-2\"\r\n                  maxLength={30}\r\n                />\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Line 2\"\r\n                  value={customText.line2}\r\n                  onChange={(e) => setCustomText({ ...customText, line2: e.target.value })}\r\n                  className=\"w-full px-4 py-2 rounded-lg bg-[var(--surface-800)] border border-[var(--surface-700)]\"\r\n                  maxLength={30}\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            \r\n\r\n            {/* Quantity */}\r\n            <div className=\"mb-6\">\r\n              <label className=\"block text-sm font-medium mb-2\">Quantity</label>\r\n              <input\r\n                type=\"number\"\r\n                min=\"1\"\r\n                value={quantity}\r\n                onChange={(e) => setQuantity(parseInt(e.target.value) || 1)}\r\n                className=\"w-24 px-4 py-2 rounded-lg bg-[var(--surface-800)] border border-[var(--surface-700)]\"\r\n              />\r\n            </div>\r\n\r\n            {/* Add to Cart Button */}\r\n            <button\r\n              onClick={handleAddToCart}\r\n              disabled={addingToCart}\r\n              className=\"w-full btn btn-primary py-3 rounded-lg text-lg font-semibold disabled:opacity-50\"\r\n            >\r\n              {addingToCart ? 'Adding to Cart...' : `Add to Cart - $${calculateTotal().toFixed(2)}`}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ImageEditor Modal */}\r\n        {product.requiresImage && product.maskImageUrl && (\r\n          <ImageEditor\r\n            show={showEditor}\r\n            onHide={() => setShowEditor(false)}\r\n            uploadedImage={uploadedImage}\r\n            maskImage={product.maskImageUrl}\r\n            onSave={handleImageEditorSave}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}