{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/utils/logger.ts"],"sourcesContent":["// utils/logger.ts\r\n// Version: 1.3.0 | Date: 2025-11-05\r\n// ‚úÖ Fixed: Added missing warn() method\r\n// Environment-aware logging utility\r\n\r\nconst ENV_MODE = process.env.NEXT_PUBLIC_ENV_MODE || 'development'\r\nconst IS_DEV = ENV_MODE === 'development'\r\nconst IS_TEST = ENV_MODE === 'testing'\r\nconst IS_PROD = ENV_MODE === 'production'\r\n\r\n// Only log in dev and testing modes\r\nconst shouldLog = IS_DEV || IS_TEST\r\n\r\nexport const logger = {\r\n  // API calls\r\n  api: (endpoint: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üåê API Call: ${endpoint}`, data)\r\n  },\r\n\r\n  // Success messages\r\n  success: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚úÖ ${message}`, data)\r\n  },\r\n\r\n  // Warning messages\r\n  warn: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.warn(`‚ö†Ô∏è ${message}`, data)\r\n  },\r\n\r\n  // Error tracking\r\n  error: (message: string, error?: any) => {\r\n    if (!shouldLog) return\r\n    console.error(`‚ùå ${message}`, error)\r\n  },\r\n\r\n  // Image loading\r\n  image: (status: 'loading' | 'loaded' | 'error', path: string) => {\r\n    if (!shouldLog) return\r\n    const icon = status === 'loaded' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥'\r\n    console.log(`${icon} Image ${status}: ${path}`)\r\n  },\r\n\r\n  // Order processing\r\n  order: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üì¶ Order ${step}:`, data)\r\n  },\r\n\r\n  // Product data\r\n  product: (action: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üî∑ Product ${action}:`, data)\r\n  },\r\n\r\n  // Payment processing\r\n  payment: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üí≥ Payment ${step}:`, data)\r\n  },\r\n\r\n  // General info\r\n  info: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚ÑπÔ∏è ${message}`, data)\r\n  }\r\n}\r\n\r\nexport const isDevelopment = IS_DEV\r\nexport const isTesting = IS_TEST\r\nexport const isProduction = IS_PROD"],"names":[],"mappings":"AAAA,kBAAkB;AAClB,oCAAoC;AACpC,uCAAuC;AACvC,oCAAoC;;;;;;;AAEnB;AAAjB,MAAM,WAAW,mDAAoC;AACrD,MAAM,SAAS,aAAa;AAC5B,MAAM,UAAU,aAAa;AAC7B,MAAM,UAAU,aAAa;AAE7B,oCAAoC;AACpC,MAAM,YAAY,UAAU;AAErB,MAAM,SAAS;IACpB,YAAY;IACZ,KAAK,CAAC,UAAkB;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,gBAAwB,OAAT,WAAY;IAC1C;IAEA,mBAAmB;IACnB,SAAS,CAAC,SAAiB;QACzB;;QACA,QAAQ,GAAG,CAAC,AAAC,KAAY,OAAR,UAAW;IAC9B;IAEA,mBAAmB;IACnB,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,IAAI,CAAC,AAAC,MAAa,OAAR,UAAW;IAChC;IAEA,iBAAiB;IACjB,OAAO,CAAC,SAAiB;QACvB;;QACA,QAAQ,KAAK,CAAC,AAAC,KAAY,OAAR,UAAW;IAChC;IAEA,gBAAgB;IAChB,OAAO,CAAC,QAAwC;QAC9C;;QACA,MAAM,OAAO,WAAW,WAAW,MAAM,WAAW,UAAU,MAAM;QACpE,QAAQ,GAAG,CAAC,AAAC,GAAgB,OAAd,MAAK,WAAoB,OAAX,QAAO,MAAS,OAAL;IAC1C;IAEA,mBAAmB;IACnB,OAAO,CAAC,MAAc;QACpB;;QACA,QAAQ,GAAG,CAAC,AAAC,YAAgB,OAAL,MAAK,MAAI;IACnC;IAEA,eAAe;IACf,SAAS,CAAC,QAAgB;QACxB;;QACA,QAAQ,GAAG,CAAC,AAAC,cAAoB,OAAP,QAAO,MAAI;IACvC;IAEA,qBAAqB;IACrB,SAAS,CAAC,MAAc;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,cAAkB,OAAL,MAAK,MAAI;IACrC;IAEA,eAAe;IACf,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,GAAG,CAAC,AAAC,MAAa,OAAR,UAAW;IAC/B;AACF;AAEO,MAAM,gBAAgB;AACtB,MAAM,YAAY;AAClB,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 93, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/lib/imageStorageDB.ts"],"sourcesContent":["// lib/imageStorageDB.ts\r\n// Version: 1.0.0 - 2025-11-10\r\n// Purpose: Handle large image storage using IndexedDB to avoid localStorage quota issues\r\n// IndexedDB has much higher storage limits (typically 50% of free disk space)\r\n\r\nimport { logger } from '@/utils/logger'\r\n\r\nconst DB_NAME = 'CrystalKeepsakesImages'\r\nconst DB_VERSION = 1\r\nconst STORE_NAME = 'cartImages'\r\n\r\ninterface ImageRecord {\r\n  id: string\r\n  productId: string\r\n  dataUrl: string\r\n  thumbnail: string\r\n  metadata: {\r\n    filename?: string\r\n    mimeType?: string\r\n    fileSize?: number\r\n    width?: number\r\n    height?: number\r\n    processedAt?: string\r\n    maskId?: string\r\n    maskName?: string\r\n  }\r\n  timestamp: number\r\n}\r\n\r\nclass ImageStorageDB {\r\n  private db: IDBDatabase | null = null\r\n\r\n  /**\r\n   * Initialize the database\r\n   */\r\n  async init(): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION)\r\n\r\n      request.onerror = () => {\r\n        logger.error('Failed to open IndexedDB', request.error)\r\n        reject(request.error)\r\n      }\r\n\r\n      request.onsuccess = () => {\r\n        this.db = request.result\r\n        logger.info('IndexedDB initialized successfully')\r\n        resolve()\r\n      }\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result\r\n\r\n        // Create object store if it doesn't exist\r\n        if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n          const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'id' })\r\n          objectStore.createIndex('productId', 'productId', { unique: false })\r\n          objectStore.createIndex('timestamp', 'timestamp', { unique: false })\r\n          logger.info('Created IndexedDB object store')\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Ensure database is initialized\r\n   */\r\n  private async ensureDb(): Promise<IDBDatabase> {\r\n    if (!this.db) {\r\n      await this.init()\r\n    }\r\n    if (!this.db) {\r\n      throw new Error('Failed to initialize database')\r\n    }\r\n    return this.db\r\n  }\r\n\r\n  /**\r\n   * Store an image in IndexedDB\r\n   */\r\n  async storeImage(\r\n    productId: string,\r\n    dataUrl: string,\r\n    thumbnail: string,\r\n    metadata?: ImageRecord['metadata']\r\n  ): Promise<string> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n      const id = `${productId}_${Date.now()}`\r\n\r\n      const imageRecord: ImageRecord = {\r\n        id,\r\n        productId,\r\n        dataUrl,\r\n        thumbnail,\r\n        metadata: metadata || {},\r\n        timestamp: Date.now()\r\n      }\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.add(imageRecord)\r\n\r\n        request.onsuccess = () => {\r\n          logger.success('Image stored in IndexedDB', {\r\n            id,\r\n            productId,\r\n            sizeKB: Math.round(dataUrl.length / 1024)\r\n          })\r\n          resolve(id)\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to store image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error storing image', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieve an image from IndexedDB\r\n   */\r\n  async getImage(id: string): Promise<ImageRecord | null> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.get(id)\r\n\r\n        request.onsuccess = () => {\r\n          const result = request.result\r\n          if (result) {\r\n            logger.info('Image retrieved from IndexedDB', { id })\r\n            resolve(result)\r\n          } else {\r\n            logger.warn('Image not found', { id })\r\n            resolve(null)\r\n          }\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to retrieve image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error retrieving image', error)\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all images for a product\r\n   */\r\n  async getProductImages(productId: string): Promise<ImageRecord[]> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const index = objectStore.index('productId')\r\n        const request = index.getAll(productId)\r\n\r\n        request.onsuccess = () => {\r\n          const results = request.result || []\r\n          logger.info(`Retrieved ${results.length} images for product`, { productId })\r\n          resolve(results)\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to retrieve product images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error retrieving product images', error)\r\n      return []\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Delete an image from IndexedDB\r\n   */\r\n  async deleteImage(id: string): Promise<void> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.delete(id)\r\n\r\n        request.onsuccess = () => {\r\n          logger.info('Image deleted from IndexedDB', { id })\r\n          resolve()\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to delete image', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error deleting image', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all images (useful for cart clear)\r\n   */\r\n  async clearAll(): Promise<void> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const request = objectStore.clear()\r\n\r\n        request.onsuccess = () => {\r\n          logger.info('All images cleared from IndexedDB')\r\n          resolve()\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to clear images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error clearing images', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up old images (older than 7 days)\r\n   */\r\n  async cleanupOldImages(): Promise<number> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n      const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000)\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readwrite')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const index = objectStore.index('timestamp')\r\n        const range = IDBKeyRange.upperBound(sevenDaysAgo)\r\n        const request = index.openCursor(range)\r\n        \r\n        let deletedCount = 0\r\n\r\n        request.onsuccess = (event) => {\r\n          const cursor = (event.target as IDBRequest).result\r\n          if (cursor) {\r\n            objectStore.delete(cursor.primaryKey)\r\n            deletedCount++\r\n            cursor.continue()\r\n          } else {\r\n            logger.info(`Cleaned up ${deletedCount} old images`)\r\n            resolve(deletedCount)\r\n          }\r\n        }\r\n\r\n        request.onerror = () => {\r\n          logger.error('Failed to cleanup old images', request.error)\r\n          reject(request.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error cleaning up old images', error)\r\n      return 0\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get database statistics\r\n   */\r\n  async getStats(): Promise<{\r\n    totalImages: number\r\n    estimatedSizeMB: number\r\n  }> {\r\n    try {\r\n      const db = await this.ensureDb()\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction([STORE_NAME], 'readonly')\r\n        const objectStore = transaction.objectStore(STORE_NAME)\r\n        const countRequest = objectStore.count()\r\n        const getAllRequest = objectStore.getAll()\r\n\r\n        countRequest.onsuccess = () => {\r\n          const count = countRequest.result\r\n\r\n          getAllRequest.onsuccess = () => {\r\n            const records = getAllRequest.result || []\r\n            const totalSize = records.reduce((sum, record) => {\r\n              return sum + (record.dataUrl?.length || 0) + (record.thumbnail?.length || 0)\r\n            }, 0)\r\n\r\n            resolve({\r\n              totalImages: count,\r\n              estimatedSizeMB: totalSize / (1024 * 1024)\r\n            })\r\n          }\r\n        }\r\n\r\n        countRequest.onerror = () => {\r\n          reject(countRequest.error)\r\n        }\r\n      })\r\n    } catch (error) {\r\n      logger.error('Error getting database stats', error)\r\n      return { totalImages: 0, estimatedSizeMB: 0 }\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const imageDB = new ImageStorageDB()\r\n\r\n// Initialize on import\r\nif (typeof window !== 'undefined') {\r\n  imageDB.init().catch((error) => {\r\n    logger.error('Failed to initialize ImageStorageDB', error)\r\n  })\r\n}"],"names":[],"mappings":"AAAA,wBAAwB;AACxB,8BAA8B;AAC9B,yFAAyF;AACzF,8EAA8E;;;;;AAE9E;;;AAEA,MAAM,UAAU;AAChB,MAAM,aAAa;AACnB,MAAM,aAAa;AAoBnB,MAAM;IAGJ;;GAEC,GACD,MAAM,OAAsB;QAC1B,OAAO,IAAI,QAAQ,CAAC,SAAS;YAC3B,MAAM,UAAU,UAAU,IAAI,CAAC,SAAS;YAExC,QAAQ,OAAO,GAAG;gBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,4BAA4B,QAAQ,KAAK;gBACtD,OAAO,QAAQ,KAAK;YACtB;YAEA,QAAQ,SAAS,GAAG;gBAClB,IAAI,CAAC,EAAE,GAAG,QAAQ,MAAM;gBACxB,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC;gBACZ;YACF;YAEA,QAAQ,eAAe,GAAG,CAAC;gBACzB,MAAM,KAAK,AAAC,MAAM,MAAM,CAAsB,MAAM;gBAEpD,0CAA0C;gBAC1C,IAAI,CAAC,GAAG,gBAAgB,CAAC,QAAQ,CAAC,aAAa;oBAC7C,MAAM,cAAc,GAAG,iBAAiB,CAAC,YAAY;wBAAE,SAAS;oBAAK;oBACrE,YAAY,WAAW,CAAC,aAAa,aAAa;wBAAE,QAAQ;oBAAM;oBAClE,YAAY,WAAW,CAAC,aAAa,aAAa;wBAAE,QAAQ;oBAAM;oBAClE,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC;gBACd;YACF;QACF;IACF;IAEA;;GAEC,GACD,MAAc,WAAiC;QAC7C,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;YACZ,MAAM,IAAI,CAAC,IAAI;QACjB;QACA,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE;YACZ,MAAM,IAAI,MAAM;QAClB;QACA,OAAO,IAAI,CAAC,EAAE;IAChB;IAEA;;GAEC,GACD,MAAM,WACJ,SAAiB,EACjB,OAAe,EACf,SAAiB,EACjB,QAAkC,EACjB;QACjB,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAC9B,MAAM,KAAK,AAAC,GAAe,OAAb,WAAU,KAAc,OAAX,KAAK,GAAG;YAEnC,MAAM,cAA2B;gBAC/B;gBACA;gBACA;gBACA;gBACA,UAAU,YAAY,CAAC;gBACvB,WAAW,KAAK,GAAG;YACrB;YAEA,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,UAAU,YAAY,GAAG,CAAC;gBAEhC,QAAQ,SAAS,GAAG;oBAClB,yHAAA,CAAA,SAAM,CAAC,OAAO,CAAC,6BAA6B;wBAC1C;wBACA;wBACA,QAAQ,KAAK,KAAK,CAAC,QAAQ,MAAM,GAAG;oBACtC;oBACA,QAAQ;gBACV;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,yBAAyB,QAAQ,KAAK;oBACnD,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,uBAAuB;YACpC,MAAM;QACR;IACF;IAEA;;GAEC,GACD,MAAM,SAAS,EAAU,EAA+B;QACtD,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAE9B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,UAAU,YAAY,GAAG,CAAC;gBAEhC,QAAQ,SAAS,GAAG;oBAClB,MAAM,SAAS,QAAQ,MAAM;oBAC7B,IAAI,QAAQ;wBACV,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,kCAAkC;4BAAE;wBAAG;wBACnD,QAAQ;oBACV,OAAO;wBACL,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,mBAAmB;4BAAE;wBAAG;wBACpC,QAAQ;oBACV;gBACF;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,4BAA4B,QAAQ,KAAK;oBACtD,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,0BAA0B;YACvC,OAAO;QACT;IACF;IAEA;;GAEC,GACD,MAAM,iBAAiB,SAAiB,EAA0B;QAChE,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAE9B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,QAAQ,YAAY,KAAK,CAAC;gBAChC,MAAM,UAAU,MAAM,MAAM,CAAC;gBAE7B,QAAQ,SAAS,GAAG;oBAClB,MAAM,UAAU,QAAQ,MAAM,IAAI,EAAE;oBACpC,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,AAAC,aAA2B,OAAf,QAAQ,MAAM,EAAC,wBAAsB;wBAAE;oBAAU;oBAC1E,QAAQ;gBACV;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,qCAAqC,QAAQ,KAAK;oBAC/D,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,mCAAmC;YAChD,OAAO,EAAE;QACX;IACF;IAEA;;GAEC,GACD,MAAM,YAAY,EAAU,EAAiB;QAC3C,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAE9B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,UAAU,YAAY,MAAM,CAAC;gBAEnC,QAAQ,SAAS,GAAG;oBAClB,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,gCAAgC;wBAAE;oBAAG;oBACjD;gBACF;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,0BAA0B,QAAQ,KAAK;oBACpD,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,wBAAwB;YACrC,MAAM;QACR;IACF;IAEA;;GAEC,GACD,MAAM,WAA0B;QAC9B,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAE9B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,UAAU,YAAY,KAAK;gBAEjC,QAAQ,SAAS,GAAG;oBAClB,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC;oBACZ;gBACF;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,0BAA0B,QAAQ,KAAK;oBACpD,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,yBAAyB;YACtC,MAAM;QACR;IACF;IAEA;;GAEC,GACD,MAAM,mBAAoC;QACxC,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAC9B,MAAM,eAAe,KAAK,GAAG,KAAM,IAAI,KAAK,KAAK,KAAK;YAEtD,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,QAAQ,YAAY,KAAK,CAAC;gBAChC,MAAM,QAAQ,YAAY,UAAU,CAAC;gBACrC,MAAM,UAAU,MAAM,UAAU,CAAC;gBAEjC,IAAI,eAAe;gBAEnB,QAAQ,SAAS,GAAG,CAAC;oBACnB,MAAM,SAAS,AAAC,MAAM,MAAM,CAAgB,MAAM;oBAClD,IAAI,QAAQ;wBACV,YAAY,MAAM,CAAC,OAAO,UAAU;wBACpC;wBACA,OAAO,QAAQ;oBACjB,OAAO;wBACL,yHAAA,CAAA,SAAM,CAAC,IAAI,CAAC,AAAC,cAA0B,OAAb,cAAa;wBACvC,QAAQ;oBACV;gBACF;gBAEA,QAAQ,OAAO,GAAG;oBAChB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,gCAAgC,QAAQ,KAAK;oBAC1D,OAAO,QAAQ,KAAK;gBACtB;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,gCAAgC;YAC7C,OAAO;QACT;IACF;IAEA;;GAEC,GACD,MAAM,WAGH;QACD,IAAI;YACF,MAAM,KAAK,MAAM,IAAI,CAAC,QAAQ;YAE9B,OAAO,IAAI,QAAQ,CAAC,SAAS;gBAC3B,MAAM,cAAc,GAAG,WAAW,CAAC;oBAAC;iBAAW,EAAE;gBACjD,MAAM,cAAc,YAAY,WAAW,CAAC;gBAC5C,MAAM,eAAe,YAAY,KAAK;gBACtC,MAAM,gBAAgB,YAAY,MAAM;gBAExC,aAAa,SAAS,GAAG;oBACvB,MAAM,QAAQ,aAAa,MAAM;oBAEjC,cAAc,SAAS,GAAG;wBACxB,MAAM,UAAU,cAAc,MAAM,IAAI,EAAE;wBAC1C,MAAM,YAAY,QAAQ,MAAM,CAAC,CAAC,KAAK;gCACvB,iBAAgC;4BAA9C,OAAO,MAAM,CAAC,EAAA,kBAAA,OAAO,OAAO,cAAd,sCAAA,gBAAgB,MAAM,KAAI,CAAC,IAAI,CAAC,EAAA,oBAAA,OAAO,SAAS,cAAhB,wCAAA,kBAAkB,MAAM,KAAI,CAAC;wBAC7E,GAAG;wBAEH,QAAQ;4BACN,aAAa;4BACb,iBAAiB,YAAY,CAAC,OAAO,IAAI;wBAC3C;oBACF;gBACF;gBAEA,aAAa,OAAO,GAAG;oBACrB,OAAO,aAAa,KAAK;gBAC3B;YACF;QACF,EAAE,OAAO,OAAO;YACd,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,gCAAgC;YAC7C,OAAO;gBAAE,aAAa;gBAAG,iBAAiB;YAAE;QAC9C;IACF;;QAtSA,+KAAQ,MAAyB;;AAuSnC;AAGO,MAAM,UAAU,IAAI;AAE3B,uBAAuB;AACvB,wCAAmC;IACjC,QAAQ,IAAI,GAAG,KAAK,CAAC,CAAC;QACpB,yHAAA,CAAA,SAAM,CAAC,KAAK,CAAC,uCAAuC;IACtD;AACF","debugId":null}},
    {"offset": {"line": 399, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/lib/cartUtils.ts"],"sourcesContent":["// lib/cartUtils.ts\r\n// Version: 2.0.0 - 2025-11-10 - INDEXEDDB IMAGE STORAGE\r\n// Fixed: Moved image storage to IndexedDB to avoid localStorage quota issues\r\n// - Images stored in IndexedDB (50% of free disk space limit)\r\n// - Only image IDs stored in localStorage cart\r\n// - Automatic cleanup of orphaned images\r\n// - Better error handling and recovery\r\n\r\nimport { logger } from '@/utils/logger'\r\nimport { imageDB } from './imageStorageDB'\r\nimport { uploadImageStorage } from './api/upload-image.php'\r\n\r\nexport interface CartItem {\r\n  productId: string\r\n  name: string\r\n  sku: string\r\n  price: number\r\n  quantity: number\r\n  options: any\r\n  sizeDetails?: any\r\n  customImageId?: string  // Changed from customImage object to just ID\r\n  customImageMetadata?: {  // Light metadata for display\r\n    filename?: string\r\n    maskName?: string\r\n    hasImage: boolean\r\n  }\r\n  cockpit3d_id?: string\r\n  dateAdded: string\r\n}\r\n\r\n/**\r\n * Compress image to TINY thumbnail for cart display\r\n * Reduces base64 size by ~97% (e.g., 2MB -> 60KB)\r\n */\r\nasync function compressImageToThumbnail(dataUrl: string): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image()\r\n    img.onload = () => {\r\n      const canvas = document.createElement('canvas')\r\n      const MAX_SIZE = 100 // Small thumbnail size\r\n      let width = img.width\r\n      let height = img.height\r\n      \r\n      // Maintain aspect ratio\r\n      if (width > height) {\r\n        if (width > MAX_SIZE) {\r\n          height = (height * MAX_SIZE) / width\r\n          width = MAX_SIZE\r\n        }\r\n      } else {\r\n        if (height > MAX_SIZE) {\r\n          width = (width * MAX_SIZE) / height\r\n          height = MAX_SIZE\r\n        }\r\n      }\r\n      \r\n      canvas.width = width\r\n      canvas.height = height\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(img, 0, 0, width, height)\r\n      \r\n      // Lower quality JPEG for minimal size\r\n      resolve(canvas.toDataURL('image/jpeg', 0.5))\r\n    }\r\n    img.onerror = () => reject(new Error('Image compression failed'))\r\n    img.src = dataUrl\r\n  })\r\n}\r\n\r\n/**\r\n * Clean options object - remove ALL image data URLs\r\n */\r\nfunction cleanOptions(options: any): any {\r\n  if (!options) return {}\r\n  \r\n  const cleaned = { ...options }\r\n  \r\n  // Remove all image data URLs from options\r\n  delete cleaned.rawImageUrl\r\n  delete cleaned.imageUrl\r\n  delete cleaned.maskedImageUrl\r\n  delete cleaned.dataUrl\r\n  delete cleaned.customImage\r\n  \r\n  // Keep only essential metadata\r\n  return {\r\n    size: cleaned.size,\r\n    background: cleaned.background,\r\n    lightBase: cleaned.lightBase,\r\n    giftStand: cleaned.giftStand,\r\n    customText: cleaned.customText,\r\n    // Only keep image filenames, not data URLs\r\n    imageFilename: cleaned.imageFilename,\r\n    maskName: cleaned.maskName\r\n  }\r\n}\r\n\r\n/**\r\n * Add item to cart with IndexedDB image storage\r\n */\r\nexport async function addToCart(item: CartItem | any): Promise<void> {\r\n  logger.order('Adding item to cart', {\r\n    productId: item.productId,\r\n    hasCustomImage: !!item.customImage?.dataUrl || !!item.options?.maskedImageUrl\r\n  })\r\n  \r\n  try {\r\n    const cart = getCart()\r\n    let customImageId: string | undefined\r\n    let customImageMetadata: CartItem['customImageMetadata'] | undefined\r\n    \r\n    // Handle custom image storage in IndexedDB\r\n    const imageDataUrl = item.customImage?.dataUrl || item.options?.maskedImageUrl\r\n    if (imageDataUrl) {\r\n      try {\r\n        // Compress thumbnail\r\n        const thumbnail = await compressImageToThumbnail(imageDataUrl)\r\n        \r\n        // Store full image and thumbnail in IndexedDB\r\n        customImageId = await imageDB.storeImage(\r\n          item.productId,\r\n          imageDataUrl,\r\n          thumbnail,\r\n          {\r\n            filename: item.customImage?.filename || item.options?.imageFilename,\r\n            mimeType: item.customImage?.mimeType || 'image/png',\r\n            fileSize: item.customImage?.fileSize || imageDataUrl.length,\r\n            width: item.customImage?.width,\r\n            height: item.customImage?.height,\r\n            processedAt: item.customImage?.processedAt || new Date().toISOString(),\r\n            maskId: item.customImage?.maskId || item.options?.maskId,\r\n            maskName: item.customImage?.maskName || item.options?.maskName\r\n          }\r\n        )\r\n        \r\n        customImageMetadata = {\r\n          filename: item.customImage?.filename || item.options?.imageFilename,\r\n          maskName: item.customImage?.maskName || item.options?.maskName,\r\n          hasImage: true\r\n        }\r\n        \r\n        logger.success('Image stored in IndexedDB', {\r\n          imageId: customImageId,\r\n          originalSizeKB: Math.round(imageDataUrl.length / 1024),\r\n          thumbnailSizeKB: Math.round(thumbnail.length / 1024)\r\n        })\r\n      } catch (error) {\r\n        logger.error('Failed to store image in IndexedDB', error)\r\n        // Continue without image rather than fail entire add\r\n        customImageId = undefined\r\n        customImageMetadata = { hasImage: false }\r\n      }\r\n    }\r\n    \r\n    // Clean options to remove any image data\r\n    const cleanedOptions = cleanOptions(item.options)\r\n    \r\n    // Create cart item with just image ID reference\r\n    const cartItem: CartItem = {\r\n      productId: item.productId,\r\n      name: item.name,\r\n      sku: item.sku,\r\n      price: item.price || item.totalPrice,\r\n      quantity: item.quantity,\r\n      options: cleanedOptions,\r\n      sizeDetails: item.size || item.sizeDetails,\r\n      customImageId,\r\n      customImageMetadata,\r\n      cockpit3d_id: item.cockpit3d_id,\r\n      dateAdded: item.dateAdded || new Date().toISOString()\r\n    }\r\n    \r\n    cart.push(cartItem)\r\n    saveCart(cart)\r\n    \r\n    // Clean up old images periodically\r\n    if (Math.random() < 0.1) { // 10% chance on each add\r\n      imageDB.cleanupOldImages().catch(err => \r\n        logger.warn('Background image cleanup failed', err)\r\n      )\r\n    }\r\n    \r\n    logger.success('Item added to cart', { \r\n      totalItems: cart.length,\r\n      hasImage: !!customImageId\r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to add item to cart', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n/**\r\n * Get cart from localStorage\r\n */\r\nexport function getCart(): CartItem[] {\r\n  try {\r\n    const cartData = localStorage.getItem('cart')\r\n    return cartData ? JSON.parse(cartData) : []\r\n  } catch (error) {\r\n    logger.error('Failed to read cart', error)\r\n    return []\r\n  }\r\n}\r\n\r\n/**\r\n * Get cart with images loaded from IndexedDB\r\n */\r\nexport async function getCartWithImages(): Promise<Array<CartItem & { \r\n  customImage?: { \r\n    dataUrl: string\r\n    thumbnail: string\r\n    metadata: any\r\n  } \r\n}>> {\r\n  const cart = getCart()\r\n  \r\n  // Load images from IndexedDB\r\n  const cartWithImages = await Promise.all(\r\n    cart.map(async (item) => {\r\n      if (item.customImageId) {\r\n        try {\r\n          const imageRecord = await imageDB.getImage(item.customImageId)\r\n          if (imageRecord) {\r\n            return {\r\n              ...item,\r\n              customImage: {\r\n                dataUrl: imageRecord.dataUrl,\r\n                thumbnail: imageRecord.thumbnail,\r\n                metadata: imageRecord.metadata\r\n              }\r\n            }\r\n          }\r\n        } catch (error) {\r\n          logger.warn(`Failed to load image for cart item`, { \r\n            productId: item.productId,\r\n            imageId: item.customImageId,\r\n            error \r\n          })\r\n        }\r\n      }\r\n      return item\r\n    })\r\n  )\r\n  \r\n  return cartWithImages\r\n}\r\n\r\n/**\r\n * Save cart to localStorage (without images)\r\n */\r\nexport function saveCart(cart: CartItem[]): void {\r\n  try {\r\n    const cartJson = JSON.stringify(cart)\r\n    const sizeKB = (cartJson.length / 1024).toFixed(2)\r\n    \r\n    logger.info('Saving cart to localStorage', { \r\n      items: cart.length, \r\n      sizeKB,\r\n      hasImages: cart.filter(item => item.customImageId).length\r\n    })\r\n    \r\n    localStorage.setItem('cart', cartJson)\r\n    \r\n    // Dispatch custom event to notify all listeners\r\n    const event = new CustomEvent('cartUpdated', { \r\n      detail: { \r\n        itemCount: cart.length,\r\n        totalItems: cart.reduce((sum, item) => sum + item.quantity, 0)\r\n      } \r\n    })\r\n    window.dispatchEvent(event)\r\n    \r\n  } catch (error: any) {\r\n    logger.error('Failed to save cart', error)\r\n    \r\n    if (error.name === 'QuotaExceededError') {\r\n      // This should be rare now since images are in IndexedDB\r\n      // Try clearing some old data\r\n      try {\r\n        cleanupLocalStorage()\r\n        localStorage.setItem('cart', JSON.stringify(cart))\r\n        logger.warn('Cart saved after cleanup')\r\n      } catch (fallbackError) {\r\n        throw new Error('Unable to save cart. Please clear browser data.')\r\n      }\r\n    } else {\r\n      throw error\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Remove item from cart by index\r\n */\r\nexport async function removeFromCart(index: number): Promise<CartItem[]> {\r\n  const cart = getCart()\r\n  const removedItem = cart[index]\r\n  \r\n  // Delete associated image from IndexedDB\r\n  if (removedItem?.customImageId) {\r\n    try {\r\n      await imageDB.deleteImage(removedItem.customImageId)\r\n      logger.info('Deleted image from IndexedDB', { \r\n        imageId: removedItem.customImageId \r\n      })\r\n    } catch (error) {\r\n      logger.warn('Failed to delete image from IndexedDB', error)\r\n    }\r\n  }\r\n  \r\n  cart.splice(index, 1)\r\n  saveCart(cart)\r\n  return cart\r\n}\r\n\r\n/**\r\n * Clear entire cart and all images\r\n */\r\nexport async function clearCart(): Promise<void> {\r\n  localStorage.removeItem('cart')\r\n  \r\n  // Clear all images from IndexedDB\r\n  try {\r\n    await imageDB.clearAll()\r\n    logger.info('Cleared all images from IndexedDB')\r\n  } catch (error) {\r\n    logger.warn('Failed to clear images from IndexedDB', error)\r\n  }\r\n  \r\n  window.dispatchEvent(new CustomEvent('cartUpdated', { \r\n    detail: { itemCount: 0, totalItems: 0 } \r\n  }))\r\n}\r\n\r\n/**\r\n * Get total item count\r\n */\r\nexport function getCartItemCount(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + item.quantity, 0)\r\n}\r\n\r\n/**\r\n * Get cart total price\r\n */\r\nexport function getCartTotal(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)\r\n}\r\n\r\n/**\r\n * Check localStorage health\r\n */\r\nexport function checkStorageHealth(): { \r\n  isHealthy: boolean\r\n  usedSpace: number\r\n  totalSpace: number\r\n  percentUsed: number\r\n  message?: string\r\n} {\r\n  try {\r\n    let totalSize = 0\r\n    for (let key in localStorage) {\r\n      if (localStorage.hasOwnProperty(key)) {\r\n        totalSize += localStorage[key].length + key.length\r\n      }\r\n    }\r\n    \r\n    // Most browsers have 5MB limit\r\n    const STORAGE_LIMIT = 5242880\r\n    const percentUsed = (totalSize / STORAGE_LIMIT) * 100\r\n    \r\n    logger.info('Storage health check', {\r\n      usedKB: (totalSize / 1024).toFixed(2),\r\n      percentUsed: percentUsed.toFixed(1) + '%'\r\n    })\r\n    \r\n    return {\r\n      isHealthy: percentUsed < 90,\r\n      usedSpace: totalSize,\r\n      totalSpace: STORAGE_LIMIT,\r\n      percentUsed,\r\n      message: percentUsed > 80 ? 'Storage nearly full' : undefined\r\n    }\r\n    \r\n  } catch (error) {\r\n    logger.error('Storage health check failed', error)\r\n    return {\r\n      isHealthy: false,\r\n      usedSpace: 0,\r\n      totalSpace: 0,\r\n      percentUsed: 100,\r\n      message: 'Storage check failed'\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Clean up unnecessary data from localStorage\r\n */\r\nfunction cleanupLocalStorage(): void {\r\n  try {\r\n    // Remove old/temporary data\r\n    const keysToCheck = Object.keys(localStorage)\r\n    keysToCheck.forEach(key => {\r\n      // Remove old temporary data\r\n      if (key.startsWith('temp_') || key.startsWith('old_')) {\r\n        localStorage.removeItem(key)\r\n      }\r\n    })\r\n    logger.info('Cleaned up localStorage')\r\n  } catch (error) {\r\n    logger.error('localStorage cleanup failed', error)\r\n  }\r\n}\r\n\r\n/**\r\n * Get IndexedDB stats\r\n */\r\nexport async function getImageStorageStats() {\r\n  try {\r\n    const stats = await imageDB.getStats()\r\n    return {\r\n      ...stats,\r\n      storageHealth: checkStorageHealth()\r\n    }\r\n  } catch (error) {\r\n    logger.error('Failed to get storage stats', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Estimate size of data to be stored (backward compatibility)\r\n */\r\nexport function estimateSize(data: any): number {\r\n  try {\r\n    return JSON.stringify(data).length\r\n  } catch (error) {\r\n    logger.error('Failed to estimate data size', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n/**\r\n * Store full-resolution image (backward compatibility)\r\n * Now uses IndexedDB instead of sessionStorage\r\n */\r\nexport async function storeFullResImage(productId: string, dataUrl: string): Promise<void> {\r\n  try {\r\n    // Create a thumbnail for storage\r\n    const thumbnail = await compressImageToThumbnail(dataUrl)\r\n    \r\n    // Store in IndexedDB\r\n    await imageDB.storeImage(\r\n      productId,\r\n      dataUrl,\r\n      thumbnail,\r\n      {\r\n        processedAt: new Date().toISOString()\r\n      }\r\n    )\r\n    \r\n    logger.info('Full-res image stored in IndexedDB', { \r\n      productId, \r\n      sizeKB: (dataUrl.length / 1024).toFixed(2) \r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to store full-res image', error)\r\n    \r\n    // Fallback to sessionStorage for backward compatibility\r\n    try {\r\n      sessionStorage.setItem(`fullimg_${productId}`, dataUrl)\r\n      logger.warn('Fell back to sessionStorage for image storage')\r\n    } catch (e) {\r\n      logger.error('All image storage methods failed', e)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieve full-resolution image (backward compatibility)\r\n * Checks both IndexedDB and sessionStorage\r\n */\r\nexport async function getFullResImage(productId: string): Promise<string | null> {\r\n  try {\r\n    // First try IndexedDB\r\n    const images = await imageDB.getProductImages(productId)\r\n    if (images.length > 0) {\r\n      return images[0].dataUrl\r\n    }\r\n    \r\n    // Fallback to sessionStorage\r\n    const sessionImage = sessionStorage.getItem(`fullimg_${productId}`)\r\n    if (sessionImage) {\r\n      logger.info('Retrieved image from sessionStorage fallback')\r\n      return sessionImage\r\n    }\r\n    \r\n    return null\r\n  } catch (error) {\r\n    logger.error('Could not retrieve full-res image', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Migrate old cart format to new format (for backwards compatibility)\r\n */\r\nexport async function migrateOldCart(): Promise<void> {\r\n  try {\r\n    const cart = getCart()\r\n    let needsMigration = false\r\n    \r\n    const migratedCart = await Promise.all(\r\n      cart.map(async (item: any) => {\r\n        // Check if item has old format with embedded image\r\n        if (item.customImage?.dataUrl && !item.customImageId) {\r\n          needsMigration = true\r\n          \r\n          try {\r\n            // Store image in IndexedDB\r\n            const thumbnail = await compressImageToThumbnail(item.customImage.dataUrl)\r\n            const imageId = await imageDB.storeImage(\r\n              item.productId,\r\n              item.customImage.dataUrl,\r\n              thumbnail,\r\n              item.customImage\r\n            )\r\n            \r\n            // Return migrated item\r\n            return {\r\n              ...item,\r\n              customImageId: imageId,\r\n              customImageMetadata: {\r\n                filename: item.customImage.filename,\r\n                maskName: item.customImage.maskName,\r\n                hasImage: true\r\n              },\r\n              customImage: undefined // Remove embedded image\r\n            }\r\n          } catch (error) {\r\n            logger.warn('Failed to migrate image for item', { \r\n              productId: item.productId, \r\n              error \r\n            })\r\n            return {\r\n              ...item,\r\n              customImage: undefined\r\n            }\r\n          }\r\n        }\r\n        return item\r\n      })\r\n    )\r\n    \r\n    if (needsMigration) {\r\n      saveCart(migratedCart)\r\n      logger.info('Cart migrated to new format')\r\n    }\r\n  } catch (error) {\r\n    logger.error('Cart migration failed', error)\r\n  }\r\n}\r\n\r\n// Auto-migrate on load\r\nif (typeof window !== 'undefined') {\r\n  migrateOldCart().catch(err => \r\n    logger.warn('Auto-migration failed', err)\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 850, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/app/cart/page.tsx"],"sourcesContent":["// app/cart/page.tsx\r\n// Version: 3.0.0 - 2025-11-11 - MERGED & FIXED\r\n// ‚úÖ Merged: All functions from original files preserved\r\n// ‚úÖ Fixed: updateQuantity uses cartUtils.saveCart\r\n// ‚úÖ Fixed: Options display handles both formats\r\n// ‚úÖ Enhanced: Layout from page-1/page-2\r\n\r\n'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\nimport { Trash2 } from 'lucide-react'\r\nimport { \r\n  getCartWithImages, \r\n  removeFromCart, \r\n  clearCart, \r\n  getCartTotal,\r\n  getImageStorageStats\r\n} from '@/lib/cartUtils'\r\nimport { logger } from '@/utils/logger'\r\n\r\n// ‚úÖ PRESERVE: Type interface from original files\r\ninterface CartItem {\r\n  productId: string\r\n  name: string\r\n  sku: string\r\n  price: number\r\n  quantity: number\r\n  options: any\r\n  sizeDetails?: any\r\n  customImage?: {\r\n    dataUrl: string\r\n    thumbnail: string\r\n    metadata: any\r\n  }\r\n  customImageMetadata?: {\r\n    filename?: string\r\n    maskName?: string\r\n    hasImage: boolean\r\n  }\r\n  cockpit3d_id?: string\r\n  dateAdded: string\r\n}\r\n\r\nexport default function CartPage() {\r\n  const [cart, setCart] = useState<CartItem[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [removing, setRemoving] = useState<number | null>(null)\r\n  const [storageStats, setStorageStats] = useState<any>(null)\r\n  const [checkoutLoading, setCheckoutLoading] = useState(false)\r\n  const [total, setTotal] = useState(0) // ‚úÖ PRESERVE: total state\r\n\r\n  // ‚úÖ PRESERVE: loadCart from page.tsx\r\n  const loadCart = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const cartWithImages = await getCartWithImages()\r\n      setCart(cartWithImages)\r\n      \r\n      // ‚úÖ PRESERVE: Calculate total like page-2\r\n      const sum = cartWithImages.reduce((acc, item) => {\r\n        const itemPrice = item.price || (item as any).totalPrice || 0\r\n        return acc + (itemPrice * item.quantity)\r\n      }, 0)\r\n      setTotal(sum)\r\n      \r\n      // ‚úÖ PRESERVE: Storage stats from page.tsx\r\n      const stats = await getImageStorageStats()\r\n      setStorageStats(stats)\r\n      \r\n      logger.info('Cart loaded with images', {\r\n        items: cartWithImages.length,\r\n        withImages: cartWithImages.filter(item => item.customImage).length\r\n      })\r\n    } catch (error) {\r\n      logger.error('Failed to load cart', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadCart()\r\n\r\n    // ‚úÖ PRESERVE: Event listener from page.tsx\r\n    const handleCartUpdate = () => {\r\n      loadCart()\r\n    }\r\n    window.addEventListener('cartUpdated', handleCartUpdate)\r\n    \r\n    return () => {\r\n      window.removeEventListener('cartUpdated', handleCartUpdate)\r\n    }\r\n  }, [])\r\n\r\n  // ‚úÖ PRESERVE: handleRemoveItem from page.tsx\r\n  const handleRemoveItem = async (index: number) => {\r\n    setRemoving(index)\r\n    try {\r\n      await removeFromCart(index)\r\n      await loadCart()\r\n      logger.success('Item removed from cart')\r\n    } catch (error) {\r\n      logger.error('Failed to remove item', error)\r\n    } finally {\r\n      setRemoving(null)\r\n    }\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: handleClearCart from page.tsx\r\n  const handleClearCart = async () => {\r\n    if (confirm('Are you sure you want to clear your entire cart?')) {\r\n      try {\r\n        await clearCart()\r\n        setCart([])\r\n        logger.success('Cart cleared')\r\n      } catch (error) {\r\n        logger.error('Failed to clear cart', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  // ‚úÖ FIXED: updateQuantity uses cartUtils.saveCart (strips images)\r\n  const updateQuantity = async (index: number, newQuantity: number) => {\r\n    if (newQuantity < 1) return\r\n    \r\n    try {\r\n      const currentCart = await getCartWithImages()\r\n      currentCart[index].quantity = newQuantity\r\n      \r\n      // ‚úÖ FIXED: Import and use saveCart from cartUtils\r\n      const { saveCart } = await import('@/lib/cartUtils')\r\n      saveCart(currentCart)\r\n      \r\n      await loadCart()\r\n      window.dispatchEvent(new Event('cartUpdated'))\r\n    } catch (error) {\r\n      logger.error('Failed to update quantity', error)\r\n    }\r\n  }\r\n\r\n  // ‚úÖ ENHANCED: Normalize options for display\r\n  const getDisplayOptions = (item: any): Record<string, string> => {\r\n    const options: Record<string, string> = {}\r\n    \r\n    // New format: options array\r\n    if (Array.isArray(item.options)) {\r\n      item.options.forEach((opt: any) => {\r\n        if (opt.category === 'customText') {\r\n          options['Custom Text'] = opt.value\r\n        } else if (opt.value && opt.value !== 'None') {\r\n          options[opt.category || opt.name] = opt.value\r\n        }\r\n      })\r\n    } \r\n    // Old format: flat object\r\n    else if (item.options) {\r\n      Object.entries(item.options).forEach(([key, value]) => {\r\n        if (value && value !== 'None' && key !== 'imageFilename' && key !== 'maskName') {\r\n          options[key] = String(value)\r\n        }\r\n      })\r\n    }\r\n    \r\n    if (item.sizeDetails?.sizeName) {\r\n      options['Size'] = item.sizeDetails.sizeName\r\n    }\r\n    \r\n    return options\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: buildCockpitOrder from page-2\r\n  function buildCockpitOrder(): any {\r\n    const orderNumber = `CK-${Date.now()}`\r\n    \r\n    return {\r\n      order_id: orderNumber,\r\n      customer_name: '',\r\n      email: '',\r\n      phone: '',\r\n      staff_user: 'Web Order',\r\n      shipping_method: 'air',\r\n      destination: 'customer_home',\r\n      shipping_address: {},\r\n      billing_address: {},\r\n      items: cart.map(item => ({\r\n        sku: item.sku || item.productId,\r\n        qty: item.quantity,\r\n        price: item.price || (item as any).totalPrice || 0,\r\n        name: item.name,\r\n        custom_options: buildCustomOptions(item),\r\n        custom_image_url: item.customImage?.dataUrl || item.options?.rawImageUrl || item.options?.imageUrl || undefined\r\n      })),\r\n      total: total\r\n    }\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: buildCustomOptions from page-2\r\n  function buildCustomOptions(item: CartItem) {\r\n    const options: Array<{ option_id: string; option_value: string }> = []\r\n    \r\n    const getOptionValue = (option: any): string => {\r\n      if (!option) return ''\r\n      if (typeof option === 'string') return option\r\n      if (typeof option === 'object') return option.name || option.id || String(option)\r\n      return String(option)\r\n    }\r\n    \r\n    if (item.options.size) {\r\n      options.push({\r\n        option_id: 'size',\r\n        option_value: item.sizeDetails?.name || getOptionValue(item.options.size)\r\n      })\r\n    }\r\n    \r\n    if (item.options.background) {\r\n      options.push({\r\n        option_id: 'background',\r\n        option_value: getOptionValue(item.options.background)\r\n      })\r\n    }\r\n    \r\n    if (item.options.lightBase) {\r\n      options.push({\r\n        option_id: 'lightBase',\r\n        option_value: getOptionValue(item.options.lightBase)\r\n      })\r\n    }\r\n    \r\n    if (item.options.giftStand) {\r\n      options.push({\r\n        option_id: 'giftStand',\r\n        option_value: getOptionValue(item.options.giftStand)\r\n      })\r\n    }\r\n    \r\n    if (item.options.customText) {\r\n      const textValue = typeof item.options.customText === 'string' \r\n        ? item.options.customText\r\n        : [\r\n            item.options.customText.line1 && `Line 1: ${item.options.customText.line1}`,\r\n            item.options.customText.line2 && `Line 2: ${item.options.customText.line2}`\r\n          ].filter(Boolean).join(' | ')\r\n      \r\n      options.push({\r\n        option_id: 'customText',\r\n        option_value: textValue\r\n      })\r\n    }\r\n    \r\n    return options\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: proceedToCheckout from page-2\r\n  async function proceedToCheckout() {\r\n    setCheckoutLoading(true)\r\n    \r\n    try {\r\n      const orderData = buildCockpitOrder()\r\n      \r\n      sessionStorage.setItem('pendingOrder', JSON.stringify({\r\n        cartItems: cart,\r\n        subtotal: total,\r\n        total: total,\r\n        orderNumber: orderData.order_id,\r\n        cockpitOrderData: orderData\r\n      }))\r\n      \r\n      window.location.href = '/checkout'\r\n      \r\n    } catch (error) {\r\n      console.error('Checkout error:', error)\r\n      alert('Failed to proceed to checkout. Please try again.')\r\n      setCheckoutLoading(false)\r\n    }\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: Loading state from page-2\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-tr from-gray-200 via-gray-100 to-gray-50 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-slate-600\">Loading your cart...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ‚úÖ PRESERVE: Empty state from page-2\r\n  if (cart.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-tr from-gray-200 via-gray-100 to-gray-50\">\r\n        <div className=\"max-w-7xl mx-auto p-6\">\r\n          <div className=\"text-center py-12\">\r\n            <h2 className=\"text-2xl font-semibold text-slate-900 mb-4\">Your cart is empty</h2>\r\n            <p className=\"text-slate-600 mb-6\">Add some beautiful crystal keepsakes to get started!</p>\r\n            <Link \r\n              href=\"/products\" \r\n              className=\"inline-block px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors\"\r\n            >\r\n              Continue Shopping\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-tr from-green-900 via-gray-300 to-green-100\">\r\n      <div className=\"max-w-7xl max-lg:max-w-4xl mx-auto p-6\">\r\n        {/* ‚úÖ ENHANCED: Header from page-2 */}\r\n        <div className=\"flex items-center justify-between mb-6 text-slate-900\">\r\n          <h2 className=\"text-xl font-semibold text-slate-900\">Your shopping cart</h2>\r\n          <button\r\n            onClick={handleClearCart}\r\n            className=\"text-sm text-red-600 hover:text-red-700 font-medium\"\r\n          >\r\n            Clear Cart\r\n          </button>\r\n        </div>\r\n\r\n        {/* ‚úÖ PRESERVE: Storage Stats from page.tsx */}\r\n        {process.env.NODE_ENV === 'development' && storageStats && (\r\n          <div className=\"bg-slate-700 rounded-lg p-4 mb-6 text-sm text-gray-300\">\r\n            <h3 className=\"font-bold mb-2\">Storage Stats:</h3>\r\n            <div className=\"grid grid-cols-2 gap-2\">\r\n              <div>localStorage: {storageStats.storageHealth.percentUsed.toFixed(1)}% used</div>\r\n              <div>IndexedDB Images: {storageStats.totalImages}</div>\r\n              <div>localStorage Size: {(storageStats.storageHealth.usedSpace / 1024).toFixed(1)} KB</div>\r\n              <div>Image Storage: {storageStats.estimatedSizeMB.toFixed(2)} MB</div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* ‚úÖ ENHANCED: 2-column layout from page-2 */}\r\n        <div className=\"grid lg:grid-cols-3 gap-4 relative\">\r\n          {/* Cart Items Column */}\r\n          <div className=\"lg:col-span-2 space-y-4\">\r\n            {cart.map((item, index) => {\r\n              const displayImage = item.customImage?.thumbnail || \r\n                                 'https://placehold.co/800x800?text=No+Image'\r\n              \r\n              const displayOptions = getDisplayOptions(item)\r\n              \r\n              return (\r\n                <div key={index} className=\"p-6 text-slate-900 bg-white shadow-sm border border-gray-300 rounded-md relative\">\r\n                  <div className=\"flex items-start max-sm:flex-col gap-4 max-sm:gap-6\">\r\n                    \r\n                    {/* ‚úÖ ENHANCED: Product Image */}\r\n                    <div className=\"w-32 h-32 shrink-0\">\r\n                      <img \r\n                        src={displayImage}\r\n                        alt={item.name}\r\n                        className=\"w-full h-full object-contain rounded-lg\"\r\n                      />\r\n                      <img \r\n                        src={item.customImageMetadata}\r\n                        alt={item.name}\r\n                        className=\"w-full h-full object-contain rounded-lg\"\r\n                      />\r\n                    </div>\r\n\r\n                    {/* ‚úÖ ENHANCED: Product Details */}\r\n                    <div className=\"sm:border-l sm:pl-4 sm:border-gray-300 w-full\">\r\n                      <h3 className=\"text-base font-semibold text-slate-900\">{item.name}</h3>\r\n                      \r\n                      {/* ‚úÖ FIXED: Options Display */}\r\n                      {Object.keys(displayOptions).length > 0 && (\r\n                        <div className=\"text-sm text-gray-600 mt-2 space-y-1\">\r\n                          {Object.entries(displayOptions).map(([key, val]) => (\r\n                            <p key={key}><strong>{key}:</strong> {val}</p>\r\n                          ))}\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* ‚úÖ ENHANCED: Specifications */}\r\n                      <ul className=\"mt-4 text-sm text-slate-500 font-medium space-y-1\">\r\n                        {item.sku && <li>SKU: {item.sku}</li>}\r\n                        {item.sizeDetails?.sizeName && <li>Size: {item.sizeDetails.sizeName}</li>}\r\n                        {item.customImageMetadata?.hasImage && (\r\n                          <li className=\"text-emerald-600\">‚úì Custom Image: {item.customImageMetadata.filename}</li>\r\n                        )}\r\n                      </ul>\r\n\r\n                      <hr className=\"border-gray-300 my-4\" />\r\n\r\n                      {/* ‚úÖ ENHANCED: Quantity and Price */}\r\n                      <div className=\"flex items-center justify-between flex-wrap gap-4\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                          <h4 className=\"text-sm font-semibold text-slate-900\">Qty:</h4>\r\n                          <button \r\n                            type=\"button\"\r\n                            onClick={() => updateQuantity(index, item.quantity - 1)}\r\n                            className=\"flex items-center justify-center w-[18px] h-[18px] bg-blue-600 hover:bg-blue-700 outline-none rounded-sm cursor-pointer\"\r\n                          >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-2 fill-white\" viewBox=\"0 0 124 124\">\r\n                              <path d=\"M112 50H12C5.4 50 0 55.4 0 62s5.4 12 12 12h100c6.6 0 12-5.4 12-12s-5.4-12-12-12z\"></path>\r\n                            </svg>\r\n                          </button>\r\n                          <span className=\"font-semibold text-base leading-[16px]\">{item.quantity}</span>\r\n                          <button \r\n                            type=\"button\"\r\n                            onClick={() => updateQuantity(index, item.quantity + 1)}\r\n                            className=\"flex items-center justify-center w-[18px] h-[18px] bg-blue-600 hover:bg-blue-700 outline-none rounded-sm cursor-pointer\"\r\n                          >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"w-2 fill-white\" viewBox=\"0 0 42 42\">\r\n                              <path d=\"M37.059 16H26V4.941C26 2.224 23.718 0 21 0s-5 2.224-5 4.941V16H4.941C2.224 16 0 18.282 0 21s2.224 5 4.941 5H16v11.059C16 39.776 18.282 42 21 42s5-2.224 5-4.941V26h11.059C39.776 26 42 23.718 42 21s-2.224-5-4.941-5z\"></path>\r\n                            </svg>\r\n                          </button>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex items-center gap-4\">\r\n                          <h4 className=\"text-base font-semibold text-slate-900\">\r\n                            ${((item.price) * item.quantity).toFixed(2)}\r\n                          </h4>\r\n\r\n                          {/* Remove Button */}\r\n                          <button\r\n                            onClick={() => handleRemoveItem(index)}\r\n                            disabled={removing === index}\r\n                            className=\"p-2 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors disabled:opacity-50\"\r\n                          >\r\n                            {removing === index ? (\r\n                              <span className=\"inline-block w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin\"></span>\r\n                            ) : (\r\n                              <Trash2 size={20} />\r\n                            )}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* ‚úÖ ENHANCED: Debug Info */}\r\n                      {process.env.NODE_ENV === 'development' && (\r\n                        <div className=\"w-full mt-3 p-2 rounded border border-blue-200 bg-blue-50\">\r\n                          <small className=\"text-blue-700\">\r\n                            <strong>Debug:</strong><br/>\r\n                            SKU: {item.sku || 'N/A'} | \r\n                            Cockpit3D ID: {item.cockpit3d_id || 'N/A'}<br/>\r\n                            Image: {item.customImageMetadata?.hasImage ? 'Yes' : 'No'} | \r\n                            {item.customImage && ` ${(item.customImage.metadata?.fileSize / 1024).toFixed(1)}KB`}\r\n                          </small>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )\r\n            })}\r\n          </div>\r\n\r\n          {/* ‚úÖ ENHANCED: Sticky Order Summary */}\r\n          <div className=\"text-slate-900 bg-white h-max rounded-md p-6 shadow-sm border border-gray-300 sticky top-6\">\r\n            <h3 className=\"text-base font-semibold text-slate-900\">Order Summary</h3>\r\n            <ul className=\"text-slate-500 font-medium text-sm divide-y divide-gray-300 mt-4\">\r\n              <li className=\"flex flex-wrap gap-4 py-3\">\r\n                Subtotal \r\n                <span className=\"ml-auto font-semibold text-slate-900\">${total.toFixed(2)}</span>\r\n              </li>\r\n              <li className=\"flex flex-wrap gap-4 py-3\">\r\n                Shipping \r\n                <span className=\"ml-auto font-semibold text-slate-900\">Calculated at checkout</span>\r\n              </li>\r\n              <li className=\"flex flex-wrap gap-4 py-3\">\r\n                Tax \r\n                <span className=\"ml-auto font-semibold text-slate-900\">Calculated at checkout</span>\r\n              </li>\r\n              <li className=\"flex flex-wrap gap-4 py-3 font-semibold text-slate-900 text-lg\">\r\n                Total \r\n                <span className=\"ml-auto\">${total.toFixed(2)}</span>\r\n              </li>\r\n            </ul>\r\n            \r\n            {/* ‚úÖ FIXED: Checkout Button that uses proceedToCheckout */}\r\n            <button \r\n              type=\"button\" \r\n              onClick={proceedToCheckout}\r\n              disabled={checkoutLoading}\r\n              className=\"mt-6 text-sm font-medium px-4 py-2.5 tracking-wide w-full bg-blue-600 hover:bg-blue-700 text-white rounded-md cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {checkoutLoading ? (\r\n                <span className=\"flex items-center justify-center\">\r\n                  <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                  </svg>\r\n                  Processing...\r\n                </span>\r\n              ) : (\r\n                'Proceed to Checkout'\r\n              )}\r\n            </button>\r\n            <p className=\"text-center text-slate-500 text-xs mt-4\">\r\n              üîí Secure checkout powered by Stripe\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* ‚úÖ PRESERVE: Continue Shopping Link */}\r\n        <div className=\"text-center mt-8\">\r\n          <Link \r\n            href=\"/products\" \r\n            className=\"text-blue-600 hover:underline font-medium\"\r\n          >\r\n            ‚Üê Continue Shopping\r\n          </Link>\r\n        </div>\r\n\r\n        {/* ‚úÖ ENHANCED: Full Debug Section */}\r\n        {process.env.NODE_ENV === 'development' && (\r\n          <div className=\"mt-8 pt-4 border-t border-gray-300\">\r\n            <h6 className=\"text-amber-600 font-semibold mb-3\">üîß Developer Mode - Cart Debug</h6>\r\n            \r\n            <div className=\"bg-slate-900 p-4 rounded mb-3\">\r\n              <h6 className=\"text-slate-400 text-sm mb-2\">üì¶ Raw Cart Data (with IndexedDB images)</h6>\r\n              <pre className=\"text-slate-100 text-xs overflow-auto\" style={{ maxHeight: '300px' }}>\r\n                {JSON.stringify(cart, null, 2)}\r\n              </pre>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1842, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/lucide-react/dist/esm/icons/trash-2.js","sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/node_modules/lucide-react/src/icons/trash-2.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M10 11v6', key: 'nco0om' }],\n  ['path', { d: 'M14 11v6', key: 'outv1u' }],\n  ['path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6', key: 'miytrc' }],\n  ['path', { d: 'M3 6h18', key: 'd0wm0j' }],\n  ['path', { d: 'M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2', key: 'e791ji' }],\n];\n\n/**\n * @component @name Trash2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTF2NiIgLz4KICA8cGF0aCBkPSJNMTQgMTF2NiIgLz4KICA8cGF0aCBkPSJNMTkgNnYxNGEyIDIgMCAwIDEtMiAySDdhMiAyIDAgMCAxLTItMlY2IiAvPgogIDxwYXRoIGQ9Ik0zIDZoMTgiIC8+CiAgPHBhdGggZD0iTTggNlY0YTIgMiAwIDAgMSAyLTJoNGEyIDIgMCAwIDEgMiAydjIiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/trash-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trash2 = createLucideIcon('trash-2', __iconNode);\n\nexport default Trash2;\n"],"names":[],"mappings":";;;;;;;;;;;AAGO,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,UAAA,CAAA,CAAA,CAAuB;IAClC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAA4C,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzE;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAW,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACxC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAA0C,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;CACzE;AAaA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAA,CAAA,CAAA,2KAAS,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAiB,CAAjB,AAAiB,CAAjB,AAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAW,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA","debugId":null}},
    {"offset": {"line": 1905, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/node_modules/%40swc/helpers/esm/_define_property.js"],"sourcesContent":["function _define_property(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true });\n    } else obj[key] = value;\n\n    return obj;\n}\nexport { _define_property as _ };\n"],"names":[],"mappings":";;;AAAA,SAAS,iBAAiB,GAAG,EAAE,GAAG,EAAE,KAAK;IACrC,IAAI,OAAO,KAAK;QACZ,OAAO,cAAc,CAAC,KAAK,KAAK;YAAE,OAAO;YAAO,YAAY;YAAM,cAAc;YAAM,UAAU;QAAK;IACzG,OAAO,GAAG,CAAC,IAAI,GAAG;IAElB,OAAO;AACX","ignoreList":[0],"debugId":null}}]
}