{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/utils/logger.ts"],"sourcesContent":["// utils/logger.ts\r\n// Version: 1.3.0 | Date: 2025-11-05\r\n// ‚úÖ Fixed: Added missing warn() method\r\n// Environment-aware logging utility\r\n\r\nconst ENV_MODE = process.env.NEXT_PUBLIC_ENV_MODE || 'development'\r\nconst IS_DEV = ENV_MODE === 'development'\r\nconst IS_TEST = ENV_MODE === 'testing'\r\nconst IS_PROD = ENV_MODE === 'production'\r\n\r\n// Only log in dev and testing modes\r\nconst shouldLog = IS_DEV || IS_TEST\r\n\r\nexport const logger = {\r\n  // API calls\r\n  api: (endpoint: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üåê API Call: ${endpoint}`, data)\r\n  },\r\n\r\n  // Success messages\r\n  success: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚úÖ ${message}`, data)\r\n  },\r\n\r\n  // Warning messages\r\n  warn: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.warn(`‚ö†Ô∏è ${message}`, data)\r\n  },\r\n\r\n  // Error tracking\r\n  error: (message: string, error?: any) => {\r\n    if (!shouldLog) return\r\n    console.error(`‚ùå ${message}`, error)\r\n  },\r\n\r\n  // Image loading\r\n  image: (status: 'loading' | 'loaded' | 'error', path: string) => {\r\n    if (!shouldLog) return\r\n    const icon = status === 'loaded' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥'\r\n    console.log(`${icon} Image ${status}: ${path}`)\r\n  },\r\n\r\n  // Order processing\r\n  order: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üì¶ Order ${step}:`, data)\r\n  },\r\n\r\n  // Product data\r\n  product: (action: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üî∑ Product ${action}:`, data)\r\n  },\r\n\r\n  // Payment processing\r\n  payment: (step: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`üí≥ Payment ${step}:`, data)\r\n  },\r\n\r\n  // General info\r\n  info: (message: string, data?: any) => {\r\n    if (!shouldLog) return\r\n    console.log(`‚ÑπÔ∏è ${message}`, data)\r\n  }\r\n}\r\n\r\nexport const isDevelopment = IS_DEV\r\nexport const isTesting = IS_TEST\r\nexport const isProduction = IS_PROD"],"names":[],"mappings":"AAAA,kBAAkB;AAClB,oCAAoC;AACpC,uCAAuC;AACvC,oCAAoC;;;;;;;AAEpC,MAAM,WAAW,mDAAoC;AACrD,MAAM,SAAS,aAAa;AAC5B,MAAM,UAAU,aAAa;AAC7B,MAAM,UAAU,aAAa;AAE7B,oCAAoC;AACpC,MAAM,YAAY,UAAU;AAErB,MAAM,SAAS;IACpB,YAAY;IACZ,KAAK,CAAC,UAAkB;QACtB;;QACA,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,UAAU,EAAE;IAC1C;IAEA,mBAAmB;IACnB,SAAS,CAAC,SAAiB;QACzB;;QACA,QAAQ,GAAG,CAAC,CAAC,EAAE,EAAE,SAAS,EAAE;IAC9B;IAEA,mBAAmB;IACnB,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,IAAI,CAAC,CAAC,GAAG,EAAE,SAAS,EAAE;IAChC;IAEA,iBAAiB;IACjB,OAAO,CAAC,SAAiB;QACvB;;QACA,QAAQ,KAAK,CAAC,CAAC,EAAE,EAAE,SAAS,EAAE;IAChC;IAEA,gBAAgB;IAChB,OAAO,CAAC,QAAwC;QAC9C;;QACA,MAAM,OAAO,WAAW,WAAW,MAAM,WAAW,UAAU,MAAM;QACpE,QAAQ,GAAG,CAAC,GAAG,KAAK,OAAO,EAAE,OAAO,EAAE,EAAE,MAAM;IAChD;IAEA,mBAAmB;IACnB,OAAO,CAAC,MAAc;QACpB;;QACA,QAAQ,GAAG,CAAC,CAAC,SAAS,EAAE,KAAK,CAAC,CAAC,EAAE;IACnC;IAEA,eAAe;IACf,SAAS,CAAC,QAAgB;QACxB;;QACA,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC,EAAE;IACvC;IAEA,qBAAqB;IACrB,SAAS,CAAC,MAAc;QACtB;;QACA,QAAQ,GAAG,CAAC,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC,EAAE;IACrC;IAEA,eAAe;IACf,MAAM,CAAC,SAAiB;QACtB;;QACA,QAAQ,GAAG,CAAC,CAAC,GAAG,EAAE,SAAS,EAAE;IAC/B;AACF;AAEO,MAAM,gBAAgB;AACtB,MAAM,YAAY;AAClB,MAAM,eAAe","debugId":null}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/lib/cartUtils.ts"],"sourcesContent":["// lib/cartUtils.ts\r\n// Version: 1.4.0 - 2025-11-08 - ENHANCED QUOTA MANAGEMENT\r\n// Fixed: QuotaExceededError with aggressive cleanup\r\n// Removes ALL image URLs from options object (prevents duplicates)\r\n// Better compression: 100x100 thumbnails at 50% quality\r\n// Automatic cleanup when approaching quota limit\r\n// Previous: 150x150 thumbnails with basic compression\r\n\r\nimport { logger } from '@/utils/logger'\r\n\r\nexport interface CartItem {\r\n  productId: string\r\n  name: string\r\n  sku: string\r\n  price: number\r\n  quantity: number\r\n  options: any\r\n  sizeDetails?: any\r\n  customImage?: {\r\n    dataUrl: string          // Compressed thumbnail for cart display\r\n    filename: string\r\n    mimeType: string\r\n    fileSize: number\r\n    width: number\r\n    height: number\r\n    processedAt?: string\r\n    maskId?: string\r\n    maskName?: string\r\n  }\r\n  cockpit3d_id?: string\r\n  dateAdded: string\r\n}\r\n\r\n/**\r\n * Compress image to TINY thumbnail for cart storage\r\n * Reduces base64 size by ~97% (e.g., 2MB -> 60KB)\r\n */\r\nasync function compressImageToThumbnail(dataUrl: string): Promise<string> {\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image()\r\n    img.onload = () => {\r\n      const canvas = document.createElement('canvas')\r\n      const MAX_SIZE = 100 // Reduced from 150 to 100 for smaller size\r\n      let width = img.width\r\n      let height = img.height\r\n      \r\n      // Maintain aspect ratio\r\n      if (width > height) {\r\n        if (width > MAX_SIZE) {\r\n          height = (height * MAX_SIZE) / width\r\n          width = MAX_SIZE\r\n        }\r\n      } else {\r\n        if (height > MAX_SIZE) {\r\n          width = (width * MAX_SIZE) / height\r\n          height = MAX_SIZE\r\n        }\r\n      }\r\n      \r\n      canvas.width = width\r\n      canvas.height = height\r\n      const ctx = canvas.getContext('2d')!\r\n      ctx.drawImage(img, 0, 0, width, height)\r\n      \r\n      // Lower quality JPEG for minimal size (reduced from 0.6 to 0.5)\r\n      resolve(canvas.toDataURL('image/jpeg', 0.5))\r\n    }\r\n    img.onerror = () => reject(new Error('Image compression failed'))\r\n    img.src = dataUrl\r\n  })\r\n}\r\n\r\n/**\r\n * Clean options object - remove ALL image data URLs\r\n * This prevents duplicate storage of images in both customImage AND options\r\n */\r\nfunction cleanOptions(options: any): any {\r\n  if (!options) return {}\r\n  \r\n  const cleaned = { ...options }\r\n  \r\n  // Remove all image data URLs from options\r\n  delete cleaned.rawImageUrl\r\n  delete cleaned.imageUrl\r\n  delete cleaned.maskedImageUrl\r\n  \r\n  // Keep only essential metadata\r\n  return {\r\n    ...cleaned,\r\n    size: cleaned.size,\r\n    background: cleaned.background,\r\n    lightBase: cleaned.lightBase,\r\n    giftStand: cleaned.giftStand,\r\n    customText: cleaned.customText,\r\n    // Only keep image filenames, not data URLs\r\n    originalImageFilename: cleaned.imageFilename,\r\n    imageFilename: cleaned.imageFilename,\r\n    maskName: cleaned.maskName\r\n  }\r\n}\r\n\r\n// Add item to cart with image compression\r\nexport async function addToCart(item: CartItem | any): Promise<void> {\r\n  logger.order('Adding item to cart', {\r\n    hasCustomImage: !!item.customImage,\r\n    originalImageSize: item.customImage?.dataUrl?.length || 0\r\n  })\r\n  \r\n  try {\r\n    // Check storage health BEFORE adding\r\n    const healthCheck = checkStorageHealth()\r\n    if (!healthCheck.isHealthy) {\r\n      throw new Error(healthCheck.message || 'Storage quota exceeded. Please clear your cart.')\r\n    }\r\n    \r\n    const cart = getCart()\r\n    // ‚úÖ Upload original and masked images to server\r\n    if (item.customImage?.dataUrl) {\r\n      const originalUrl = item.options?.rawImageUrl || item.customImage.dataUrl\r\n      const maskedUrl = item.customImage.dataUrl\r\n\r\n      try {\r\n        const originalRes = await fetch('/api/upload-image.php', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            image: originalUrl,\r\n            orderNumber: 'temp', // we‚Äôll update this later when order is created\r\n            cartItemId: item.productId,\r\n            imageType: 'original'\r\n          })\r\n        })\r\n        const maskedRes = await fetch('/api/upload-image.php', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            image: maskedUrl,\r\n            orderNumber: 'temp',\r\n            cartItemId: item.productId,\r\n            imageType: 'masked'\r\n          })\r\n        })\r\n\r\n        const originalData = await originalRes.json()\r\n        const maskedData = await maskedRes.json()\r\n\r\n        if (originalData.success) {\r\n          cartItem.options.originalImageUrl = originalData.url\r\n        }\r\n        if (maskedData.success) {\r\n          cartItem.options.maskedImageUrl = maskedData.url\r\n        }\r\n      } catch (err) {\r\n        console.warn('Image upload failed', err)\r\n      }\r\n    }\r\n    // Store full-resolution image in sessionStorage for checkout\r\n    let originalImageUrl: string | null = null\r\n    if (item.customImage?.dataUrl) {\r\n      originalImageUrl = item.customImage.dataUrl\r\n      const imageId = `${item.productId}_${Date.now()}`\r\n      storeFullResImage(imageId, originalImageUrl)\r\n    }\r\n    \r\n    // Compress custom image if present\r\n    let compressedCustomImage = item.customImage\r\n    if (item.customImage?.dataUrl) {\r\n      try {\r\n        const thumbnailUrl = await compressImageToThumbnail(item.customImage.dataUrl)\r\n        \r\n        compressedCustomImage = {\r\n          ...item.customImage,\r\n          dataUrl: thumbnailUrl, // Replace with small thumbnail\r\n          fullResId: originalImageUrl ? `${item.productId}_${Date.now()}` : undefined\r\n        }\r\n        \r\n        logger.info('Image compressed', {\r\n          original: item.customImage.dataUrl.length,\r\n          compressed: thumbnailUrl.length,\r\n          reduction: ((1 - thumbnailUrl.length / item.customImage.dataUrl.length) * 100).toFixed(1) + '%'\r\n        })\r\n      } catch (error) {\r\n        logger.error('Image compression failed, skipping image', error)\r\n        // Skip image entirely rather than risk quota error\r\n        compressedCustomImage = undefined\r\n      }\r\n    }\r\n    \r\n    // Clean options to remove duplicate image data\r\n    const cleanedOptions = cleanOptions(item.options)\r\n    \r\n    // Map to CartItem format\r\n    const cartItem: CartItem = {\r\n      productId: item.productId,\r\n      name: item.name,\r\n      sku: item.sku,\r\n      price: item.price || item.totalPrice,\r\n      quantity: item.quantity,\r\n      options: cleanedOptions, // Use cleaned options\r\n      sizeDetails: item.size || item.sizeDetails,\r\n      customImage: compressedCustomImage,\r\n      cockpit3d_id: item.cockpit3d_id,\r\n      dateAdded: item.dateAdded || new Date().toISOString()\r\n    }\r\n\r\n    // Store original uploaded image in sessionStorage\r\n    if (item.options?.rawImageUrl || item.options?.imageUrl) {\r\n      const originalUrl = item.options.rawImageUrl || item.options.imageUrl\r\n      const imageId = `original_${item.productId}_${Date.now()}`\r\n      sessionStorage.setItem(imageId, originalUrl)\r\n\r\n      // Save the ID in the cart item\r\n      cartItem.options.originalImageId = imageId\r\n    }\r\n    \r\n    cart.push(cartItem)\r\n    saveCart(cart)\r\n    \r\n    logger.success('Item added to cart', { \r\n      totalItems: cart.length,\r\n      hasImage: !!cartItem.customImage,\r\n      cartSizeKB: (JSON.stringify(cart).length / 1024).toFixed(2)\r\n    })\r\n  } catch (error) {\r\n    logger.error('Failed to add item to cart', error)\r\n    throw error\r\n  }\r\n}\r\n\r\n// Get cart from localStorage\r\nexport function getCart(): CartItem[] {\r\n  try {\r\n    const cartData = localStorage.getItem('cart')\r\n    return cartData ? JSON.parse(cartData) : []\r\n  } catch (error) {\r\n    logger.error('Failed to read cart', error)\r\n    return []\r\n  }\r\n}\r\n\r\n// Save cart with quota protection and auto-cleanup\r\nexport function saveCart(cart: CartItem[]): void {\r\n  try {\r\n    const cartJson = JSON.stringify(cart)\r\n    const sizeKB = (cartJson.length / 1024).toFixed(2)\r\n    \r\n    logger.info('Saving cart', { items: cart.length, sizeKB })\r\n    \r\n    // Check if we're approaching quota\r\n    const healthCheck = checkStorageHealth()\r\n    if (healthCheck.percentUsed > 85) {\r\n      logger.warn('Storage approaching limit, attempting cleanup')\r\n      // Try to compress existing images further if needed\r\n      const cleaned = cleanupOldCartData()\r\n      if (cleaned > 0) {\r\n        logger.info(`Cleaned up ${cleaned} bytes from cart`)\r\n      }\r\n    }\r\n    \r\n    localStorage.setItem('cart', cartJson)\r\n    \r\n    // Dispatch custom event to notify all listeners\r\n    const event = new CustomEvent('cartUpdated', { \r\n      detail: { \r\n        itemCount: cart.length,\r\n        totalItems: cart.reduce((sum, item) => sum + item.quantity, 0)\r\n      } \r\n    })\r\n    window.dispatchEvent(event)\r\n    \r\n  } catch (error: any) {\r\n    if (error.name === 'QuotaExceededError') {\r\n      logger.error('Cart storage quota exceeded', { \r\n        itemCount: cart.length,\r\n        sizeKB: (JSON.stringify(cart).length / 1024).toFixed(2)\r\n      })\r\n      \r\n      // Last resort: try to save without images\r\n      try {\r\n        const cartWithoutImages = cart.map(item => ({\r\n          ...item,\r\n          customImage: item.customImage ? {\r\n            ...item.customImage,\r\n            dataUrl: '' // Remove thumbnail data URL\r\n          } : undefined\r\n        }))\r\n        localStorage.setItem('cart', JSON.stringify(cartWithoutImages))\r\n        logger.warn('Cart saved without image thumbnails to prevent quota error')\r\n        alert('Cart is full. Images have been removed to save your items. You can still checkout.')\r\n      } catch (fallbackError) {\r\n        throw new Error('Cart storage full. Please remove some items or clear cart.')\r\n      }\r\n    } else {\r\n      logger.error('Failed to save cart', error)\r\n      throw error\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Cleanup old or unnecessary data from cart\r\n */\r\nfunction cleanupOldCartData(): number {\r\n  try {\r\n    const cart = getCart()\r\n    let savedBytes = 0\r\n    \r\n    const originalSize = JSON.stringify(cart).length\r\n    \r\n    // Remove image thumbnails from oldest items if needed\r\n    const updatedCart = cart.map((item, index) => {\r\n      if (index < cart.length - 3 && item.customImage?.dataUrl) {\r\n        // Keep only the 3 most recent items with images\r\n        savedBytes += item.customImage.dataUrl.length\r\n        return {\r\n          ...item,\r\n          customImage: {\r\n            ...item.customImage,\r\n            dataUrl: '' // Remove thumbnail from older items\r\n          }\r\n        }\r\n      }\r\n      return item\r\n    })\r\n    \r\n    if (savedBytes > 0) {\r\n      localStorage.setItem('cart', JSON.stringify(updatedCart))\r\n      logger.info('Cleaned up old cart images', { savedBytes })\r\n    }\r\n    \r\n    return savedBytes\r\n  } catch (error) {\r\n    logger.error('Cleanup failed', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n// Remove item from cart by index\r\nexport function removeFromCart(index: number): CartItem[] {\r\n  const cart = getCart()\r\n  cart.splice(index, 1)\r\n  saveCart(cart)\r\n  return cart\r\n}\r\n\r\n// Clear entire cart\r\nexport function clearCart(): void {\r\n  localStorage.removeItem('cart')\r\n  \r\n  // Also clear sessionStorage images\r\n  try {\r\n    const keys = Object.keys(sessionStorage)\r\n    keys.forEach(key => {\r\n      if (key.startsWith('fullimg_')) {\r\n        sessionStorage.removeItem(key)\r\n      }\r\n    })\r\n  } catch (error) {\r\n    logger.warn('Could not clear session images', error)\r\n  }\r\n  \r\n  window.dispatchEvent(new CustomEvent('cartUpdated', { \r\n    detail: { itemCount: 0, totalItems: 0 } \r\n  }))\r\n}\r\n\r\n// Get total item count\r\nexport function getCartItemCount(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + item.quantity, 0)\r\n}\r\n\r\n// Get cart total price\r\nexport function getCartTotal(): number {\r\n  const cart = getCart()\r\n  return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)\r\n}\r\n\r\n/**\r\n * Check localStorage health and available space\r\n * localStorage typically has 5-10MB limit\r\n */\r\nexport function checkStorageHealth(): { \r\n  isHealthy: boolean\r\n  usedSpace: number\r\n  totalSpace: number\r\n  percentUsed: number\r\n  message?: string\r\n} {\r\n  try {\r\n    // Estimate total localStorage size\r\n    let totalSize = 0\r\n    for (let key in localStorage) {\r\n      if (localStorage.hasOwnProperty(key)) {\r\n        totalSize += localStorage[key].length + key.length\r\n      }\r\n    }\r\n    \r\n    // Most browsers have 5MB (5,242,880 bytes) limit\r\n    const STORAGE_LIMIT = 5242880\r\n    const percentUsed = (totalSize / STORAGE_LIMIT) * 100\r\n    \r\n    logger.info('Storage health check', {\r\n      usedBytes: totalSize,\r\n      usedKB: (totalSize / 1024).toFixed(2),\r\n      usedMB: (totalSize / 1024 / 1024).toFixed(2),\r\n      percentUsed: percentUsed.toFixed(1) + '%'\r\n    })\r\n    \r\n    // Warning at 80%, error at 90%\r\n    if (percentUsed > 90) {\r\n      return {\r\n        isHealthy: false,\r\n        usedSpace: totalSize,\r\n        totalSpace: STORAGE_LIMIT,\r\n        percentUsed,\r\n        message: 'Storage critically full (>90%). Please clear your cart.'\r\n      }\r\n    }\r\n    \r\n    if (percentUsed > 80) {\r\n      logger.warn('Storage approaching limit', { percentUsed: percentUsed.toFixed(1) + '%' })\r\n      return {\r\n        isHealthy: true,\r\n        usedSpace: totalSize,\r\n        totalSpace: STORAGE_LIMIT,\r\n        percentUsed,\r\n        message: 'Storage nearly full (>80%). Consider clearing cart soon.'\r\n      }\r\n    }\r\n    \r\n    return {\r\n      isHealthy: true,\r\n      usedSpace: totalSize,\r\n      totalSpace: STORAGE_LIMIT,\r\n      percentUsed\r\n    }\r\n    \r\n  } catch (error) {\r\n    logger.error('Storage health check failed', error)\r\n    return {\r\n      isHealthy: false,\r\n      usedSpace: 0,\r\n      totalSpace: 0,\r\n      percentUsed: 100,\r\n      message: 'Unable to check storage. Your browser may be blocking localStorage.'\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Estimate size of data to be stored\r\n */\r\nexport function estimateSize(data: any): number {\r\n  try {\r\n    return JSON.stringify(data).length\r\n  } catch (error) {\r\n    logger.error('Failed to estimate data size', error)\r\n    return 0\r\n  }\r\n}\r\n\r\n/**\r\n * Store full-resolution image separately for checkout\r\n * Uses sessionStorage (larger limit) or IndexedDB\r\n */\r\nexport function storeFullResImage(productId: string, dataUrl: string): void {\r\n  try {\r\n    sessionStorage.setItem(`fullimg_${productId}`, dataUrl)\r\n    logger.info('Full-res image stored in sessionStorage', { \r\n      productId, \r\n      sizeKB: (dataUrl.length / 1024).toFixed(2) \r\n    })\r\n  } catch (error) {\r\n    logger.warn('Could not store full-res image in sessionStorage', error)\r\n    // Fallback: store a heavily compressed version\r\n    try {\r\n      compressImageToThumbnail(dataUrl).then(compressed => {\r\n        sessionStorage.setItem(`fullimg_${productId}`, compressed)\r\n        logger.info('Stored compressed fallback image')\r\n      })\r\n    } catch (e) {\r\n      logger.error('All image storage methods failed', e)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieve full-resolution image at checkout\r\n */\r\nexport function getFullResImage(productId: string): string | null {\r\n  try {\r\n    return sessionStorage.getItem(`fullimg_${productId}`)\r\n  } catch (error) {\r\n    logger.error('Could not retrieve full-res image', error)\r\n    return null\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 512, "column": 0}, "map": {"version":3,"sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/src/app/cart/page.tsx"],"sourcesContent":["// app/cart/page.tsx\r\n// Version: 2.0.0 - 2025-11-10\r\n// Updated to use IndexedDB image loading\r\n\r\n'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\nimport Image from 'next/image'\r\nimport { Trash2 } from 'lucide-react'\r\nimport { \r\n  getCartWithImages, \r\n  removeFromCart, \r\n  clearCart, \r\n  getCartTotal,\r\n  getImageStorageStats\r\n} from '@/lib/cartUtils'\r\nimport { logger } from '@/utils/logger'\r\n\r\ninterface CartItemWithImage {\r\n  productId: string\r\n  name: string\r\n  sku: string\r\n  price: number\r\n  quantity: number\r\n  options: any\r\n  sizeDetails?: any\r\n  customImageId?: string\r\n  customImageMetadata?: {\r\n    filename?: string\r\n    maskName?: string\r\n    hasImage: boolean\r\n  }\r\n  customImage?: {\r\n    dataUrl: string\r\n    thumbnail: string\r\n    metadata: any\r\n  }\r\n  cockpit3d_id?: string\r\n  dateAdded: string\r\n}\r\n\r\nexport default function CartPage() {\r\n  const [cart, setCart] = useState<CartItemWithImage[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [removing, setRemoving] = useState<number | null>(null)\r\n  const [storageStats, setStorageStats] = useState<any>(null)\r\n\r\n  // Load cart with images from IndexedDB\r\n  const loadCart = async () => {\r\n    try {\r\n      setLoading(true)\r\n      const cartWithImages = await getCartWithImages()\r\n      setCart(cartWithImages)\r\n      \r\n      // Get storage stats\r\n      const stats = await getImageStorageStats()\r\n      setStorageStats(stats)\r\n      \r\n      logger.info('Cart loaded with images', {\r\n        items: cartWithImages.length,\r\n        withImages: cartWithImages.filter(item => item.customImage).length\r\n      })\r\n    } catch (error) {\r\n      logger.error('Failed to load cart', error)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadCart()\r\n\r\n    // Listen for cart updates\r\n    const handleCartUpdate = () => {\r\n      loadCart()\r\n    }\r\n    window.addEventListener('cartUpdated', handleCartUpdate)\r\n    \r\n    return () => {\r\n      window.removeEventListener('cartUpdated', handleCartUpdate)\r\n    }\r\n  }, [])\r\n\r\n  const handleRemoveItem = async (index: number) => {\r\n    setRemoving(index)\r\n    try {\r\n      await removeFromCart(index)\r\n      await loadCart()\r\n      logger.success('Item removed from cart')\r\n    } catch (error) {\r\n      logger.error('Failed to remove item', error)\r\n    } finally {\r\n      setRemoving(null)\r\n    }\r\n  }\r\n\r\n  const handleClearCart = async () => {\r\n    if (confirm('Are you sure you want to clear your entire cart?')) {\r\n      try {\r\n        await clearCart()\r\n        setCart([])\r\n        logger.success('Cart cleared')\r\n      } catch (error) {\r\n        logger.error('Failed to clear cart', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const cartTotal = getCartTotal()\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-800 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"inline-block w-12 h-12 border-4 border-[#8ac644] border-t-transparent rounded-full animate-spin mb-4\"></div>\r\n          <p className=\"text-gray-400\">Loading cart...</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (cart.length === 0) {\r\n    return (\r\n      <div className=\"min-h-screen bg-slate-800\">\r\n        <section className=\"hero px-8 py-16 text-center\">\r\n          <div className=\"hero-content max-w-xl mx-auto\">\r\n            <h1 className=\"primary-header mb-4\">Your Cart is Empty</h1>\r\n            <p className=\"lead mb-8\">Add some products to get started!</p>\r\n            <Link \r\n              href=\"/products\" \r\n              className=\"btn-primary inline-block\"\r\n            >\r\n              Browse Products\r\n            </Link>\r\n          </div>\r\n        </section>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-800\">\r\n      {/* Hero Section */}\r\n      <section className=\"hero px-8 py-16 text-center\">\r\n        <div className=\"hero-content max-w-xl mx-auto\">\r\n          <h1 className=\"primary-header mb-4\">Shopping Cart</h1>\r\n          <p className=\"lead\">{cart.length} item{cart.length !== 1 ? 's' : ''} in your cart</p>\r\n        </div>\r\n      </section>\r\n\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          {/* Storage Stats (Development Only) */}\r\n          {process.env.NODE_ENV === 'development' && storageStats && (\r\n            <div className=\"bg-slate-700 rounded-lg p-4 mb-6 text-sm text-gray-300\">\r\n              <h3 className=\"font-bold mb-2\">Storage Stats:</h3>\r\n              <div className=\"grid grid-cols-2 gap-2\">\r\n                <div>localStorage: {storageStats.storageHealth.percentUsed.toFixed(1)}% used</div>\r\n                <div>IndexedDB Images: {storageStats.totalImages}</div>\r\n                <div>localStorage Size: {(storageStats.storageHealth.usedSpace / 1024).toFixed(1)} KB</div>\r\n                <div>Image Storage: {storageStats.estimatedSizeMB.toFixed(2)} MB</div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Cart Items */}\r\n          <div className=\"bg-slate-700 rounded-lg shadow-xl\">\r\n            {cart.map((item, index) => (\r\n              <div key={index} className=\"border-b border-slate-600 p-6 last:border-b-0\">\r\n                <div className=\"flex flex-col md:flex-row gap-4\">\r\n                  {/* Product Image or Custom Image */}\r\n                  <div className=\"w-full md:w-32 h-32 bg-slate-800 rounded-lg flex items-center justify-center\">\r\n                    {item.customImage?.thumbnail ? (\r\n                      <img \r\n                        src={item.customImage.thumbnail}\r\n                        alt={item.name}\r\n                        className=\"w-full h-full object-contain rounded-lg\"\r\n                      />\r\n                    ) : (\r\n                      <span className=\"text-gray-500\">No Image</span>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Product Details */}\r\n                  <div className=\"flex-1\">\r\n                    <h3 className=\"text-xl font-bold text-white mb-2\">{item.name}</h3>\r\n                    <p className=\"text-gray-400 mb-2\">SKU: {item.sku}</p>\r\n                    \r\n                    {/* Options */}\r\n                    {item.options && Object.keys(item.options).length > 0 && (\r\n                      <div className=\"text-sm text-gray-300 mb-2\">\r\n                        {Object.entries(item.options).map(([key, value]) => (\r\n                          <div key={key}>\r\n                            {key}: {String(value)}\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Custom Image Metadata */}\r\n                    {item.customImageMetadata?.hasImage && (\r\n                      <div className=\"text-sm text-green-400\">\r\n                        ‚úì Custom Image: {item.customImageMetadata.filename || 'Uploaded'}\r\n                        {item.customImageMetadata.maskName && (\r\n                          <span> ({item.customImageMetadata.maskName})</span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Price and Actions */}\r\n                  <div className=\"flex flex-col items-end justify-between\">\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-2xl font-bold text-[#8ac644]\">\r\n                        ${(item.price * item.quantity).toFixed(2)}\r\n                      </p>\r\n                      <p className=\"text-gray-400\">\r\n                        ${item.price.toFixed(2)} √ó {item.quantity}\r\n                      </p>\r\n                    </div>\r\n\r\n                    <button\r\n                      onClick={() => handleRemoveItem(index)}\r\n                      disabled={removing === index}\r\n                      className=\"mt-4 p-2 text-red-500 hover:bg-red-500 hover:text-white rounded transition-colors disabled:opacity-50\"\r\n                    >\r\n                      {removing === index ? (\r\n                        <span className=\"inline-block w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin\"></span>\r\n                      ) : (\r\n                        <Trash2 size={20} />\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n\r\n            {/* Cart Summary */}\r\n            <div className=\"bg-slate-800 p-6 rounded-b-lg\">\r\n              <div className=\"flex justify-between items-center mb-4\">\r\n                <span className=\"text-xl font-bold text-white\">Total:</span>\r\n                <span className=\"text-3xl font-bold text-[#8ac644]\">\r\n                  ${cartTotal.toFixed(2)}\r\n                </span>\r\n              </div>\r\n\r\n              <div className=\"flex gap-4\">\r\n                <button\r\n                  onClick={handleClearCart}\r\n                  className=\"flex-1 py-3 px-6 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold transition-colors\"\r\n                >\r\n                  Clear Cart\r\n                </button>\r\n                <Link\r\n                  href=\"/checkout\"\r\n                  className=\"flex-1 py-3 px-6 bg-[#8ac644] hover:bg-[#7ab534] text-black rounded-lg font-bold text-center transition-colors\"\r\n                >\r\n                  Proceed to Checkout\r\n                </Link>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Continue Shopping Link */}\r\n          <div className=\"text-center mt-8\">\r\n            <Link \r\n              href=\"/products\" \r\n              className=\"text-[#8ac644] hover:underline\"\r\n            >\r\n              ‚Üê Continue Shopping\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1069, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/lucide-react/dist/esm/icons/trash-2.js","sources":["file:///C:/MAMP/htdocs/crystalkeepsakes/node_modules/lucide-react/src/icons/trash-2.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'M10 11v6', key: 'nco0om' }],\n  ['path', { d: 'M14 11v6', key: 'outv1u' }],\n  ['path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6', key: 'miytrc' }],\n  ['path', { d: 'M3 6h18', key: 'd0wm0j' }],\n  ['path', { d: 'M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2', key: 'e791ji' }],\n];\n\n/**\n * @component @name Trash2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTF2NiIgLz4KICA8cGF0aCBkPSJNMTQgMTF2NiIgLz4KICA8cGF0aCBkPSJNMTkgNnYxNGEyIDIgMCAwIDEtMiAySDdhMiAyIDAgMCAxLTItMlY2IiAvPgogIDxwYXRoIGQ9Ik0zIDZoMTgiIC8+CiAgPHBhdGggZD0iTTggNlY0YTIgMiAwIDAgMSAyLTJoNGEyIDIgMCAwIDEgMiAydjIiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/trash-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Trash2 = createLucideIcon('trash-2', __iconNode);\n\nexport default Trash2;\n"],"names":[],"mappings":";;;;;;;;;;;AAGO,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,UAAA,CAAA,CAAA,CAAuB;IAClC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAA4C,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACzE;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAW,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IACxC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAA0C,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;CACzE;AAaA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAA,CAAA,CAAA,wKAAS,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAiB,CAAjB,AAAiB,CAAjB,AAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAW,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA","debugId":null}}]
}